import React, { useState, useRef } from 'react';

// Main App component
const App = () => {
    // State to manage form data
    const [formData, setFormData] = useState({
        fullName: '',
        fullNameEnglish: '',
        gender: '',
        maritalStatus: '',
        citizenshipNo: '',
        citizenshipIssuedDistrict: '',
        permanentAddressWard: '',
        permanentAddressMunicipality: '',
        permanentAddressDistrict: '',
        correspondenceAddressWard: '',
        correspondenceAddressMunicipality: '',
        correspondenceAddressDistrict: '',
        fatherMotherName: '',
        dob: '',
        email: '',
        phoneNumber: '',
        religion: '',
        caste: '',
        appliedPosition: '',
        appliedLevel: '',
        applicationDate: '',
    });

    // State to manage dynamic education and experience entries
    const [educationEntries, setEducationEntries] = useState([{}]);
    const [experienceEntries, setExperienceEntries] = useState([{}]);

    // State for photo preview visibility. Note: The photo upload functionality is removed as per the user's request,
    // but we keep this state for potential future use or if the user provides a photo in another way.
    const [passportPhoto, setPassportPhoto] = useState(null);
    const [previewVisible, setPreviewVisible] = useState(false);

    // Handle all form input changes
    const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData(prevData => ({ ...prevData, [name]: value }));
    };

    // Handle adding a new education entry
    const handleAddEducation = () => {
        setEducationEntries([...educationEntries, {}]);
    };

    // Handle removing an education entry
    const handleRemoveEducation = (indexToRemove) => {
        setEducationEntries(educationEntries.filter((_, index) => index !== indexToRemove));
    };

    // Handle changes in education entries
    const handleEducationChange = (index, e) => {
        const { name, value } = e.target;
        const updatedEntries = educationEntries.map((entry, i) =>
            i === index ? { ...entry, [name.split('[')[0]]: value } : entry
        );
        setEducationEntries(updatedEntries);
    };

    // Handle adding a new experience entry
    const handleAddExperience = () => {
        setExperienceEntries([...experienceEntries, {}]);
    };

    // Handle removing an experience entry
    const handleRemoveExperience = (indexToRemove) => {
        setExperienceEntries(experienceEntries.filter((_, index) => index !== indexToRemove));
    };

    // Handle changes in experience entries
    const handleExperienceChange = (index, e) => {
        const { name, value } = e.target;
        const updatedEntries = experienceEntries.map((entry, i) =>
            i === index ? { ...entry, [name.split('[')[0]]: value } : entry
        );
        setExperienceEntries(updatedEntries);
    };

    // Function to convert a Gregorian date to a simple Bikram Sambat approximation
    const gregorianToNepali = (gregorianDateString) => {
      if (!gregorianDateString) return 'N/A';

      const date = new Date(gregorianDateString);
      const gregorianYear = date.getFullYear();
      const gregorianMonth = date.getMonth() + 1;
      const gregorianDay = date.getDate();

      // Simple offset-based approximation
      let bsYear = gregorianYear + 56;
      let bsMonth = gregorianMonth + 8;
      let bsDay = gregorianDay + 17; // A common offset

      // Adjust for month and day overflows
      if (bsDay > 30) {
        bsDay -= 30;
        bsMonth += 1;
      }
      if (bsMonth > 12) {
        bsMonth -= 12;
        bsYear += 1;
      }

      // Ensure month and day are padded with leading zeros
      const formattedMonth = String(bsMonth).padStart(2, '0');
      const formattedDay = String(bsDay).padStart(2, '0');

      return `${bsYear}/${formattedMonth}/${formattedDay}`;
    };

    // Function to format date to YYYY/MM/DD (Gregorian)
    const formatDate = (dateString) => {
        if (!dateString) return 'N/A';
        const date = new Date(dateString);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}/${month}/${day}`;
    };

    return (
        <>
            <style>
                {`
                    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
                    body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; color: #333; }
                    .form-section-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem; color: #1a202c; border-bottom: 2px solid #edf2f7; padding-bottom: 0.5rem; }
                    .form-group label { font-weight: 500; color: #4a5568; }
                    .btn-primary { background-color: #4299e1; color: #fff; border: none; }
                    .btn-primary:hover { background-color: #3182ce; transform: translateY(-1px); }
                    .btn-secondary { background-color: #e2e8f0; color: #2d3748; border: 1px solid #cbd5e0; }
                    .btn-secondary:hover { background-color: #cbd5e0; transform: translateY(-1px); }
                    .photo-paste-box {
                        border: 2px dashed #a0aec0; padding: 1.5rem; border-radius: 0.5rem;
                        text-align: center; color: #718096;
                        height: 150px;
                        display: flex; flex-direction: column; align-items: center; justify-content: center;
                    }
                    .admission-card {
                        border: 2px solid #2b6cb0; border-radius: 12px; padding: 1.5rem; margin-top: 2rem; background-color: #ebf8ff; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08); position: relative; overflow: hidden;
                        display: flex; flex-direction: column; gap: 1rem;
                    }
                    .admission-card .header-top {
                        display: flex;
                        justify-content: space-between;
                        align-items: flex-start;
                        gap: 1rem;
                    }
                    .admission-card .header-center {
                        text-align: center;
                        flex-grow: 1;
                    }
                    .admission-card .header-details {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        font-size: 0.95rem;
                        margin-top: -0.5rem; /* Reduce space */
                    }
                    .admission-card .photo-box {
                        border: 1px solid #ccc; width: 120px; height: 150px; display: flex; align-items: center; justify-content: center; background-color: #fff; overflow: hidden; text-align: center;
                    }
                    .admission-card .photo-box img { max-width: 100%; max-height: 100%; object-fit: contain; }
                    .admission-card h3 { font-size: 1.7rem; font-weight: 700; color: #2b6cb0; margin-bottom: 0.5rem; text-align: center; }
                    .admission-card p { font-size: 1.1rem; margin-bottom: 0.3rem; color: #2d3748; }
                    .admission-card .logo { max-width: 80px; height: auto; }
                    .preview-form-layout { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; font-size: 0.95rem; }
                    .preview-form-layout .full-width { grid-column: 1 / -1; }
                    .preview-form-layout .section-heading { grid-column: 1 / -1; font-weight: bold; margin-top: 0.5rem; margin-bottom: 0.25rem; border-bottom: 1px solid #ccc; padding-bottom: 0.25rem; }
                    .preview-form-layout table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; grid-column: 1 / -1; }
                    .preview-form-layout table th, .preview-form-layout table td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; vertical-align: top; }
                    .preview-form-layout table th { background-color: #e2e8f0; font-weight: 600; }
                    /* Updated CSS for the preview photo box */
                    .photo-box-preview {
                        border: 1px solid #000;
                        width: 35mm;
                        height: 45mm;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        background-color: #fff;
                        overflow: hidden;
                        text-align: center;
                        font-size: 0.7rem;
                        padding: 5px;
                        line-height: 1.2;
                    }
                    .preview-form-header {
                        display: grid;
                        grid-template-columns: 1fr 2fr 1fr;
                        align-items: start;
                        gap: 1rem;
                        margin-bottom: 1rem;
                        position: relative;
                    }
                    .preview-form-header .header-text {
                        text-align: center;
                    }
                    .preview-form-header .header-right-column {
                        display: flex;
                        flex-direction: column;
                        align-items: flex-end;
                    }
                    .preview-form-header h3 { font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem; color: #2d3748; }
                    .preview-form-header p { font-size: 0.9rem; color: #4a5568; }
                    .preview-form-header .municipality-logo {
                        justify-self: start;
                        width: 80px; height: auto;
                    }
                    .thumbprint-box { border: 1px solid #000; width: 3cm; height: 3cm; display: flex; align-items: center; justify-content: center; text-align: center; font-size: 0.75rem; line-height: 1.2; padding: 5px; }
                    @media print {
                        body * { visibility: hidden; }
                        .print-area, .print-area * { visibility: visible; }
                        .print-area { position: absolute; left: 0; top: 0; width: 100%; padding: 1rem; }
                        .container { box-shadow: none; border: none; margin: 0; padding: 0; }
                        .preview-section { display: block; margin: 0; padding: 0; border: none; background-color: #fff; }
                        .button-group { display: none; }
                        .admission-card { page-break-before: always; border: 1px solid #000; padding: 1rem; margin-top: 1rem; }
                        .admission-card .photo-box { border: 1px solid #000; }
                        .preview-form-layout table th, .preview-form-layout table td { border: 1px solid #000; }
                        .preview-form-layout .photo-box-preview { border: 1px solid #000; }
                    }
                    /* Adjusted CSS to place the photo box on the right */
                    .admission-details-grid {
                      display: grid;
                      grid-template-columns: 1fr auto; /* This will place the photo on the right */
                      gap: 1rem;
                      align-items: start;
                    }
                `}
            </style>
            <div className="container">
                <h1 className="text-3xl font-bold text-center mb-8 text-gray-800">अनलाइन फाराम</h1>

                {!previewVisible && (
                    <form className="space-y-6">
                        <div className="flex flex-col md:flex-row gap-6">
                            {/* Photo paste box on the left */}
                            <div className="md:w-1/4">
                                <div className="form-section-title">फोटो</div>
                                <div className="photo-paste-box">
                                    <span>फाराम प्रिन्ट गरेपछि यहाँ पासपोर्ट साइजको फोटो टाँस्नुहोस्।</span>
                                    <span className="mt-2 text-xs text-center">(फोटो टाँसेपछि फोटोमाथि हस्ताक्षर गर्नुपर्नेछ।)</span>
                                </div>
                            </div>
                            {/* Personal details on the right */}
                            <div className="md:w-3/4 space-y-6">
                                <div className="form-section-title">व्यक्तिगत विवरण</div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="form-group">
                                        <label htmlFor="fullName">नाम, थर (देवनागरीमा): <span className="text-red-500">*</span></label>
                                        <input type="text" id="fullName" name="fullName" value={formData.fullName} onChange={handleInputChange} placeholder="पूरा नाम प्रविष्ट गर्नुहोस्" className="rounded-lg p-2 border border-gray-300 w-full" />
                                    </div>
                                    <div className="form-group">
                                        <label htmlFor="fullNameEnglish">नाम (अंग्रेजी ठूलो अक्षरमा):</label>
                                        <input type="text" id="fullNameEnglish" name="fullNameEnglish" value={formData.fullNameEnglish} onChange={handleInputChange} placeholder="FULL NAME IN ENGLISH" className="rounded-lg p-2 border border-gray-300 w-full uppercase" />
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="form-group">
                                        <label>लिङ्ग: <span className="text-red-500">*</span></label>
                                        <div className="flex items-center space-x-4">
                                            <label className="inline-flex items-center">
                                                <input type="radio" name="gender" value="पुरुष" checked={formData.gender === 'पुरुष'} onChange={handleInputChange} className="form-radio text-blue-600" />
                                                <span className="ml-2">पुरुष</span>
                                            </label>
                                            <label className="inline-flex items-center">
                                                <input type="radio" name="gender" value="महिला" checked={formData.gender === 'महिला'} onChange={handleInputChange} className="form-radio text-blue-600" />
                                                <span className="ml-2">महिला</span>
                                            </label>
                                            <label className="inline-flex items-center">
                                                <input type="radio" name="gender" value="अन्य" checked={formData.gender === 'अन्य'} onChange={handleInputChange} className="form-radio text-blue-600" />
                                                <span className="ml-2">अन्य</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div className="form-group">
                                        <label>विवाहित/अविवाहित: <span className="text-red-500">*</span></label>
                                        <div className="flex items-center space-x-4">
                                            <label className="inline-flex items-center">
                                                <input type="radio" name="maritalStatus" value="विवाहित" checked={formData.maritalStatus === 'विवाहित'} onChange={handleInputChange} className="form-radio text-blue-600" />
                                                <span className="ml-2">विवाहित</span>
                                            </label>
                                            <label className="inline-flex items-center">
                                                <input type="radio" name="maritalStatus" value="अविवाहित" checked={formData.maritalStatus === 'अविवाहित'} onChange={handleInputChange} className="form-radio text-blue-600" />
                                                <span className="ml-2">अविवाहित</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="form-group">
                                        <label htmlFor="citizenshipNo">नागरिकता नम्बर: <span className="text-red-500">*</span></label>
                                        <input type="text" id="citizenshipNo" name="citizenshipNo" value={formData.citizenshipNo} onChange={handleInputChange} placeholder="नागरिकता नम्बर प्रविष्ट गर्नुहोस्" className="rounded-lg p-2 border border-gray-300 w-full" />
                                    </div>
                                    <div className="form-group">
                                        <label htmlFor="citizenshipIssuedDistrict">जारी जिल्ला:</label>
                                        <input type="text" id="citizenshipIssuedDistrict" name="citizenshipIssuedDistrict" value={formData.citizenshipIssuedDistrict} onChange={handleInputChange} placeholder="जारी जिल्ला" className="rounded-lg p-2 border border-gray-300 w-full" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="form-group">
                            <label htmlFor="permanentAddress">स्थायी ठेगाना: <span className="text-red-500">*</span></label>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <input type="text" id="permanentAddressWard" name="permanentAddressWard" value={formData.permanentAddressWard} onChange={handleInputChange} placeholder="वडा नं." className="rounded-lg p-2 border border-gray-300 w-full" />
                                <input type="text" id="permanentAddressMunicipality" name="permanentAddressMunicipality" value={formData.permanentAddressMunicipality} onChange={handleInputChange} placeholder="गा.पा./न.पा." className="rounded-lg p-2 border border-gray-300 w-full" />
                                <input type="text" id="permanentAddressDistrict" name="permanentAddressDistrict" value={formData.permanentAddressDistrict} onChange={handleInputChange} placeholder="जिल्ला" className="rounded-lg p-2 border border-gray-300 w-full" />
                            </div>
                        </div>

                        <div className="form-group">
                            <label htmlFor="correspondenceAddress">पत्राचार गर्ने ठेगाना:</label>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <input type="text" id="correspondenceAddressWard" name="correspondenceAddressWard" value={formData.correspondenceAddressWard} onChange={handleInputChange} placeholder="वडा नं." className="rounded-lg p-2 border border-gray-300 w-full" />
                                <input type="text" id="correspondenceAddressMunicipality" name="correspondenceAddressMunicipality" value={formData.correspondenceAddressMunicipality} onChange={handleInputChange} placeholder="गा.पा./न.पा." className="rounded-lg p-2 border border-gray-300 w-full" />
                                <input type="text" id="correspondenceAddressDistrict" name="correspondenceAddressDistrict" value={formData.correspondenceAddressDistrict} onChange={handleInputChange} placeholder="जिल्ला" className="rounded-lg p-2 border border-gray-300 w-full" />
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="form-group">
                                <label htmlFor="fatherMotherName">बाबु/आमाको नाम, थर:</label>
                                <input type="text" id="fatherMotherName" name="fatherMotherName" value={formData.fatherMotherName} onChange={handleInputChange} placeholder="बाबु/आमाको पूरा नाम" className="rounded-lg p-2 border border-gray-300 w-full" />
                            </div>
                            <div className="form-group">
                                <label htmlFor="dob">जन्म मिति (वि.सं.): <span className="text-red-500">*</span></label>
                                <input type="date" id="dob" name="dob" value={formData.dob} onChange={handleInputChange} className="rounded-lg p-2 border border-gray-300 w-full" />
                            </div>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="form-group">
                                <label htmlFor="email">इमेल:</label>
                                <input type="email" id="email" name="email" value={formData.email} onChange={handleInputChange} placeholder="इमेल प्रविष्ट गर्नुहोस्" className="rounded-lg p-2 border border-gray-300 w-full" />
                            </div>
                            <div className="form-group">
                                <label htmlFor="phoneNumber">फोन नं:</label>
                                <input type="text" id="phoneNumber" name="phoneNumber" value={formData.phoneNumber} onChange={handleInputChange} placeholder="फोन नम्बर" className="rounded-lg p-2 border border-gray-300 w-full" />
                            </div>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="form-group">
                                <label htmlFor="religion">धर्म:</label>
                                <input type="text" id="religion" name="religion" value={formData.religion} onChange={handleInputChange} placeholder="धर्म" className="rounded-lg p-2 border border-gray-300 w-full" />
                            </div>
                            <div className="form-group">
                                <label htmlFor="caste">जात:</label>
                                <input type="text" id="caste" name="caste" value={formData.caste} onChange={handleInputChange} placeholder="जात" className="rounded-lg p-2 border border-gray-300 w-full" />
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="form-group">
                                <label htmlFor="appliedPosition">आवेदन दिइएको पद:</label>
                                <input type="text" id="appliedPosition" name="appliedPosition" value={formData.appliedPosition} onChange={handleInputChange} placeholder="आवेदन दिइएको पद प्रविष्ट गर्नुहोस्" className="rounded-lg p-2 border border-gray-300 w-full" />
                            </div>
                            <div className="form-group">
                                <label htmlFor="appliedLevel">आवेदन दिइएको तह:</label>
                                <input type="text" id="appliedLevel" name="appliedLevel" value={formData.appliedLevel} onChange={handleInputChange} placeholder="आवेदन दिइएको तह प्रविष्ट गर्नुहोस्" className="rounded-lg p-2 border border-gray-300 w-full" />
                            </div>
                        </div>
                        <div className="form-group">
                            <label htmlFor="applicationDate">फाराम भरेको मिति (वि.सं.): <span className="text-red-500">*</span></label>
                            <input type="date" id="applicationDate" name="applicationDate" value={formData.applicationDate} onChange={handleInputChange} className="rounded-lg p-2 border border-gray-300 w-full" />
                        </div>

                        {/* --- Table for Educational Qualification/Training in the main form --- */}
                        <div className="form-section-title">शैक्षिक योग्यता/तालिम</div>
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm table-fixed border-collapse border border-gray-300">
                                <thead>
                                    <tr className="bg-gray-100">
                                        <th className="p-2 border">शैक्षिक योग्यता</th>
                                        <th className="p-2 border">विद्यालय/बोर्ड/तालिम दिने संस्था</th>
                                        <th className="p-2 border">शैक्षिक उपाधि/तालिम</th>
                                        <th className="p-2 border">संकाय</th>
                                        <th className="p-2 border">श्रेणी/अंकिकृत</th>
                                        <th className="p-2 border">मुख्य विषय</th>
                                        <th className="p-2 border">उत्तीर्ण साल</th>
                                        <th className="p-2 border">प्रतिशत</th>
                                        <th className="p-2 border w-10"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {educationEntries.map((entry, index) => (
                                        <tr key={index} className="education-entry">
                                            <td className="p-2 border">
                                                <select name={`educationLevel[${index}]`} value={entry.educationLevel || ''} onChange={(e) => handleEducationChange(index, e)} className="rounded-lg w-full p-2">
                                                    <option value="">छान्नुहोस्</option>
                                                    <option value="SLC/SEE">SLC/SEE</option>
                                                    <option value="10+2">१०+२</option>
                                                    <option value="Bachelor">स्नातक</option>
                                                    <option value="Master">स्नातकोत्तर</option>
                                                    <option value="PhD">पीएच.डी.</option>
                                                </select>
                                            </td>
                                            <td className="p-2 border"><input type="text" name={`institution[${index}]`} value={entry.institution || ''} onChange={(e) => handleEducationChange(index, e)} placeholder="संस्था" className="rounded-lg w-full p-2" /></td>
                                            <td className="p-2 border"><input type="text" name={`educationalTitle[${index}]`} value={entry.educationalTitle || ''} onChange={(e) => handleEducationChange(index, e)} placeholder="उपाधि" className="rounded-lg w-full p-2" /></td>
                                            <td className="p-2 border"><input type="text" name={`faculty[${index}]`} value={entry.faculty || ''} onChange={(e) => handleEducationChange(index, e)} placeholder="संकाय" className="rounded-lg w-full p-2" /></td>
                                            <td className="p-2 border"><input type="text" name={`grade[${index}]`} value={entry.grade || ''} onChange={(e) => handleEducationChange(index, e)} placeholder="श्रेणी" className="rounded-lg w-full p-2" /></td>
                                            <td className="p-2 border"><input type="text" name={`majorSubject[${index}]`} value={entry.majorSubject || ''} onChange={(e) => handleEducationChange(index, e)} placeholder="मुख्य विषय" className="rounded-lg w-full p-2" /></td>
                                            <td className="p-2 border"><input type="text" name={`passingYear[${index}]`} value={entry.passingYear || ''} onChange={(e) => handleEducationChange(index, e)} placeholder="साल" className="rounded-lg w-full p-2" /></td>
                                            <td className="p-2 border"><input type="text" name={`percentage[${index}]`} value={entry.percentage || ''} onChange={(e) => handleEducationChange(index, e)} placeholder="प्रतिशत" className="rounded-lg w-full p-2" /></td>
                                            <td className="p-2 border"><button type="button" onClick={() => handleRemoveEducation(index)} className="bg-red-500 text-white px-3 py-1 rounded-md hover:bg-red-600">हटाउनुहोस्</button></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                        <button type="button" onClick={handleAddEducation} className="btn btn-secondary mt-4">थप शैक्षिक योग्यता थप्नुहोस्</button>

                        {/* --- Table for Work Experience in the main form --- */}
                        <div className="form-section-title">कार्य अनुभव</div>
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm table-fixed border-collapse border border-gray-300">
                                <thead>
                                    <tr className="bg-gray-100">
                                        <th className="p-2 border">कार्यालय</th>
                                        <th className="p-2 border">पद</th>
                                        <th className="p-2 border">सेवा/समूह/उपसमूह</th>
                                        <th className="p-2 border">श्रेणी/तह</th>
                                        <th className="p-2 border">स्थायी/अस्थायी/करार</th>
                                        <th className="p-2 border">देखि</th>
                                        <th className="p-2 border">अवधि</th>
                                        <th className="p-2 border w-10"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {experienceEntries.map((entry, index) => (
                                        <tr key={index} className="experience-entry">
                                            <td className="p-2 border"><input type="text" name={`organization[${index}]`} value={entry.organization || ''} onChange={(e) => handleExperienceChange(index, e)} placeholder="कार्यालय" className="rounded-lg w-full p-2" /></td>
                                            <td className="p-2 border"><input type="text" name={`position[${index}]`} value={entry.position || ''} onChange={(e) => handleExperienceChange(index, e)} placeholder="पद" className="rounded-lg w-full p-2" /></td>
                                            <td className="p-2 border"><input type="text" name={`serviceGroup[${index}]`} value={entry.serviceGroup || ''} onChange={(e) => handleExperienceChange(index, e)} placeholder="सेवा/समूह" className="rounded-lg w-full p-2" /></td>
                                            <td className="p-2 border"><input type="text" name={`level[${index}]`} value={entry.level || ''} onChange={(e) => handleExperienceChange(index, e)} placeholder="श्रेणी/तह" className="rounded-lg w-full p-2" /></td>
                                            <td className="p-2 border">
                                                <select name={`employmentType[${index}]`} value={entry.employmentType || ''} onChange={(e) => handleExperienceChange(index, e)} className="rounded-lg w-full p-2">
                                                    <option value="">छान्नुहोस्</option>
                                                    <option value="स्थायी">स्थायी</option>
                                                    <option value="अस्थायी">अस्थायी</option>
                                                    <option value="करार">करार</option>
                                                </select>
                                            </td>
                                            <td className="p-2 border"><input type="date" name={`fromDate[${index}]`} value={entry.fromDate || ''} onChange={(e) => handleExperienceChange(index, e)} className="rounded-lg w-full p-2" /></td>
                                            <td className="p-2 border"><input type="text" name={`duration[${index}]`} value={entry.duration || ''} onChange={(e) => handleExperienceChange(index, e)} placeholder="अवधि" className="rounded-lg w-full p-2" /></td>
                                            <td className="p-2 border"><button type="button" onClick={() => handleRemoveExperience(index)} className="bg-red-500 text-white px-3 py-1 rounded-md hover:bg-red-600">हटाउनुहोस्</button></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                        <button type="button" onClick={handleAddExperience} className="btn btn-secondary mt-4">थप कार्य अनुभव थप्नुहोस्</button>

                        <div className="flex justify-end gap-4 mt-8">
                            <button type="button" onClick={() => setPreviewVisible(true)} className="btn btn-primary">पूर्वावलोकन देखाउनुहोस्</button>
                            <button type="reset" onClick={() => {
                                setFormData({
                                    fullName: '', fullNameEnglish: '', gender: '', maritalStatus: '', citizenshipNo: '', citizenshipIssuedDistrict: '', permanentAddressWard: '', permanentAddressMunicipality: '', permanentAddressDistrict: '', correspondenceAddressWard: '', correspondenceAddressMunicipality: '', correspondenceAddressDistrict: '', fatherMotherName: '', dob: '', email: '', phoneNumber: '', religion: '', caste: '', appliedPosition: '', appliedLevel: '', applicationDate: '',
                                });
                                setEducationEntries([{}]);
                                setExperienceEntries([{}]);
                            }} className="btn btn-secondary">फाराम खाली गर्नुहोस्</button>
                        </div>
                    </form>
                )}

                {previewVisible && (
                    <div id="previewSection" className="mt-8 p-8 bg-gray-50 rounded-xl shadow-lg border border-gray-200">
                        <h2 className="text-2xl font-bold text-center mb-6 text-gray-800">फाराम पूर्वावलोकन र प्रवेशपत्र</h2>
                        <div className="print-area">
                            <div className="preview-content p-6 bg-white rounded-lg border border-dashed border-gray-400">
                                <div className="preview-form-header">
                                    <img src="https://placehold.co/80x80/A0DCF0/000000?text=LOGO" alt="नगरपालिका लोगो" className="municipality-logo" />
                                    <div className="header-text">
                                        <h3 className="text-xl font-bold">गलकोट नगरपालिका</h3>
                                        <p className="text-sm">नगर कार्यपालिकाको कार्यालय</p>
                                        <p className="text-sm">गण्डकी प्रदेश, नेपाल</p>
                                        <h4 className="text-lg font-bold w-full text-center mt-4">करारको लागि दरखास्त फाराम</h4>
                                    </div>
                                    <div className="header-right-column">
                                        <div className="photo-box-preview">
                                            <span>हालसालै खिचेको पासपोर्ट साइजको <br /> फोटो टाँस्ने र फोटो र फाराममा <br /> पनि सही गर्ने उम्मेदवारले</span>
                                        </div>
                                        <p className="mt-2 text-sm text-right">मिति: <span id="previewFormDate">{gregorianToNepali(formData.applicationDate)}</span></p>
                                    </div>
                                </div>

                                <div className="preview-form-layout mt-4">
                                    <div className="section-heading">क) बैयक्तिक विवरण</div>
                                    <div><strong>नाम, थर (देवनागरीमा):</strong> {formData.fullName || 'N/A'}</div>
                                    <div><strong>नाम (अंग्रेजी ठूलो अक्षरमा):</strong> {formData.fullNameEnglish || 'N/A'}</div>
                                    <div><strong>लिङ्ग:</strong> {formData.gender || 'N/A'}</div>
                                    <div><strong>विवाहित/अविवाहित:</strong> {formData.maritalStatus || 'N/A'}</div>
                                    <div>
                                        <strong>नागरिकता नं:</strong> {formData.citizenshipNo || 'N/A'}<br />
                                        (क) जिल्ला: {formData.citizenshipIssuedDistrict || 'N/A'}
                                    </div>
                                    <div>
                                        <strong>स्थायी ठेगाना:</strong> <br />
                                        (क) जिल्ला: {formData.permanentAddressDistrict || 'N/A'} (ख) गा.पा./न.पा.: {formData.permanentAddressMunicipality || 'N/A'} (ग) वडा नं.: {formData.permanentAddressWard || 'N/A'}
                                    </div>
                                    <div className="full-width">
                                        <strong>पत्राचार गर्ने ठेगाना:</strong> <br />
                                        (क) जिल्ला: {formData.correspondenceAddressDistrict || 'N/A'} (ख) गा.पा./न.पा.: {formData.correspondenceAddressMunicipality || 'N/A'} (ग) वडा नं.: {formData.correspondenceAddressWard || 'N/A'}
                                    </div>
                                    <div><strong>बाबुको नाम, थर:</strong> {formData.fatherMotherName || 'N/A'}</div>
                                    <div><strong>जन्म मिति (वि.सं.मा):</strong> {gregorianToNepali(formData.dob)}</div>
                                    <div><strong>इमेल:</strong> {formData.email || 'N/A'}</div>
                                    <div><strong>फोन नं:</strong> {formData.phoneNumber || 'N/A'}</div>
                                    <div><strong>धर्म:</strong> {formData.religion || 'N/A'}</div>
                                    <div><strong>जात:</strong> {formData.caste || 'N/A'}</div>
                                </div>

                                <div className="section-heading full-width mt-4">ख) शैक्षिक योग्यता/तालिम</div>
                                <table className="w-full text-sm">
                                    <thead>
                                        <tr>
                                            <th>शैक्षिक योग्यता</th>
                                            <th>विद्यालय/बोर्ड/तालिम दिने संस्था</th>
                                            <th>शैक्षिक उपाधि/तालिम</th>
                                            <th>संकाय</th>
                                            <th>श्रेणी/अंकिकृत</th>
                                            <th>मुख्य विषय</th>
                                            <th>उत्तीर्ण साल</th>
                                            <th>प्रतिशत</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {educationEntries.map((entry, index) => (
                                            <tr key={index}>
                                                <td>{entry.educationLevel || 'N/A'}</td>
                                                <td>{entry.institution || 'N/A'}</td>
                                                <td>{entry.educationalTitle || 'N/A'}</td>
                                                <td>{entry.faculty || 'N/A'}</td>
                                                <td>{entry.grade || 'N/A'}</td>
                                                <td>{entry.majorSubject || 'N/A'}</td>
                                                <td>{entry.passingYear || 'N/A'}</td>
                                                <td>{entry.percentage || 'N/A'}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>

                                <div className="section-heading full-width mt-4">ग) अनुभव सम्बन्धी विवरण</div>
                                <table className="w-full text-sm">
                                    <thead>
                                        <tr>
                                            <th>कार्यालय</th>
                                            <th>पद</th>
                                            <th>सेवा/समूह/उपसमूह</th>
                                            <th>श्रेणी/तह</th>
                                            <th>स्थायी/अस्थायी/करार</th>
                                            <th>देखि</th>
                                            <th>अवधि</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {experienceEntries.map((entry, index) => (
                                            <tr key={index}>
                                                <td>{entry.organization || 'N/A'}</td>
                                                <td>{entry.position || 'N/A'}</td>
                                                <td>{entry.serviceGroup || 'N/A'}</td>
                                                <td>{entry.level || 'N/A'}</td>
                                                <td>{entry.employmentType || 'N/A'}</td>
                                                <td>{gregorianToNepali(entry.fromDate) || 'N/A'}</td>
                                                <td>{entry.duration || 'N/A'}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>

                                <div className="full-width mt-4 text-sm">
                                    <p>मैले यस दरखास्तमा खुलाएका सम्पूर्ण विवरणहरु सत्य छन् । दरखास्त बुझाएको पदको सूचनाको लागि अनुरोध गरिएको कुनै कुरा फारामा खुलेको छैन र दरखास्तको दस्तुरमा प्रमाणित कानून बमोजिम बुझाएको छु । उम्मेदवारले फाराम भर्दा कुनै अनिमित कुरा भए यस दरखास्त फाराममा उल्लेखित शर्त तथा नियमहरु पालना गर्ने मन्जुर गर्दछु । साथै करारमा उल्लेखित शर्तहरु पूर्ण रुपमा पालना गर्नेछु र करारको समयसम्म जेजति कार्यहरु गर्नु पर्नेछ सो सबै गर्नेछु भनी यसै दरखास्त फाराम मार्फत कबुल गर्दछु ।</p>
                                    <p className="mt-4">उम्मेदवारको ब्याले सहिछाप:</p>
                                    <p className="mt-2">उम्मेदवारको दस्तखत:</p>
                                    <div className="flex justify-start gap-4 mt-4">
                                        <div className="flex flex-col items-center">
                                            <div className="thumbprint-box">दायाँ ल्याप्चे सहिछाप</div>
                                        </div>
                                        <div className="flex flex-col items-center">
                                            <div className="thumbprint-box">बायाँ ल्याप्चे सहिछाप</div>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4 mt-4">
                                        <div><strong>दर्ता नं:</strong></div>
                                        <div className="text-right"><strong>मिति:</strong> {gregorianToNepali(formData.applicationDate)}</div>
                                        <div><strong>चलानी नं:</strong></div>
                                        <div className="text-right"><strong>रोल नं:</strong> _________________________</div>
                                    </div>
                                    <p className="mt-4"><strong>दरखास्त स्वीकृतिको लागि भा. को कलम:</strong></p>
                                    <div className="grid grid-cols-2 gap-4 mt-2">
                                        <div>दरखास्त स्वीकृत/अस्वीकृत गर्नेको:</div>
                                        <div>दस्तखत:</div>
                                        <div>दरखास्त स्वीकृत/अस्वीकृत गर्नेको नाम र दस्तखत:</div>
                                        <div>मिति:</div>
                                    </div>
                                </div>
                            </div>

                            <div className="admission-card">
                                <div className="header-top">
                                    <div className="text-center">
                                        <img src="https://placehold.co/80x80/A0DCF0/000000?text=LOGO" alt="संस्थाको लोगो" className="logo" />
                                    </div>
                                    <div className="header-center">
                                        <p className="text-xs">(अनुसूची २)</p>
                                        <p className="text-xs">(दफा ५ को उपदफा (१) सँग सम्बन्धित)</p>
                                        <h2 className="text-xl font-bold text-blue-800">गलकोट नगरपालिका</h2>
                                        <p className="text-lg font-semibold">नगर कार्यपालिकाको कार्यालय</p>
                                        <p className="text-md">गलकोट, बागलुङ</p>
                                    </div>
                                </div>
                                
                                <div className="header-details">
                                    <div>
                                        <p><strong>पत्र संख्या:</strong> २०७७/०७८</p>
                                        <p><strong>चलानी नम्बर:</strong></p>
                                    </div>
                                    <div className="text-right">
                                        <p>गण्डकी प्रदेश, नेपाल</p>
                                    </div>
                                </div>

                                <h3 className="text-2xl font-bold text-center mt-2 mb-2">प्रवेश-पत्र</h3>

                                {/* Adjusted grid to place the photo box on the right, next to the details */}
                                <div className="admission-details-grid">
                                    <div className="text-base">
                                        <p><strong>नाम, थर:</strong> <span className="font-bold text-blue-700">{formData.fullName || 'N/A'}</span></p>
                                        <p><strong>पद:</strong> <span className="font-bold text-blue-700">{formData.appliedPosition || 'N/A'}</span></p>
                                        <p><strong>तह:</strong> <span className="font-bold text-blue-700">{formData.appliedLevel || 'N/A'}</span></p>
                                        <p><strong>रोल नम्बर:</strong> _________________________</p>
                                    </div>
                                    <div className="photo-box">
                                        <span className="text-sm text-gray-500">पासपोर्ट साइजको फोटो</span>
                                    </div>
                                </div>

                                <div className="description col-span-full mt-4">
                                    <p><strong>उम्मेदवारको दस्तखत नमुना :</strong></p>
                                    <p>नगर कार्यपालिकाको कार्यालयले भने : यस कार्यालयबाट लिइने उक्तपदको परीक्षामा तपाइँलाई सम्मिलित हुन अनुमति दिइएको छ । विज्ञापनमा तोकिएको शर्त नपुगेको ठहर भएमा जुनसुकै अवस्थामा पनि यो अनुमति रद्द हुनेछ ।</p>
                                </div>

                                <div className="roll-no col-span-full mt-4">
                                    <div className="border border-gray-400 w-32 h-16 mt-2"></div>
                                </div>

                                <div className="footer-left text-sm mt-8">
                                    <p>(कार्यालयको छाप)</p>
                                </div>
                                <div className="footer-right text-sm mt-8">
                                    <p>(प्रमाणित गर्नेको दस्तखत)</p>
                                </div>
                            </div>
                        </div>

                        <div className="flex justify-end gap-4 mt-8">
                            <button type="button" onClick={() => setPreviewVisible(false)} className="btn btn-secondary">सम्पादन गर्नुहोस्</button>
                            <button type="button" onClick={() => window.print()} className="btn btn-primary">प्रिन्ट गर्नुहोस्</button>
                        </div>
                    </div>
                )}
            </div>
        </>
    );
};

export default App;
