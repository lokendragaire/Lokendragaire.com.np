<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>सामाजिक सुरक्षा आवेदन फारम</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        input[type="text"], input[type="email"], input[type="tel"], textarea, select {
            transition: all 0.2s ease-in-out;
            border-color: #d1d5db;
        }
        input[type="text"]:focus, input[type="email"]:focus, input[type="tel"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        .table-data-center {
            text-align: center;
        }
        .table-header-center {
            text-align: center;
        }
        .table-cell-actions {
            white-space: nowrap;
        }
        .container {
            display: none;
        }
        .active-container {
            display: block;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            .printable, .printable * {
                visibility: visible;
            }
            .printable {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">

    <!-- मुख्य फारम कन्टेनर (Main Form Container) -->
    <div id="form-container" class="active-container bg-white p-8 rounded-2xl shadow-xl w-full max-w-4xl no-print">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">सामाजिक सुरक्षा आवेदन फारम</h1>
            <p class="mt-2 text-gray-600">कृपया तलको फारम सावधानीपूर्वक भर्नुहोस्।</p>
        </div>

        <form id="social-security-form" class="space-y-6">

            <!-- १. व्यक्तिगत विवरण (Personal Details) -->
            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">१. व्यक्तिगत विवरण</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="full-name" class="block text-sm font-medium text-gray-700">पूरा नाम (नेपालीमा):</label>
                        <input type="text" id="full-name" name="fullName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500" placeholder="जस्तै: राम बहादुर थापा">
                    </div>
                    <div>
                        <label for="full-name-en" class="block text-sm font-medium text-gray-700">Full Name (in English):</label>
                        <input type="text" id="full-name-en" name="fullNameEn" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., Ram Bahadur Thapa">
                    </div>
                    <div>
                        <label for="dob" class="block text-sm font-medium text-gray-700">जन्म मिति (वि.सं.):</label>
                        <input type="text" id="dob" name="dob" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500" placeholder="yyyy/mm/dd">
                    </div>
                    <div>
                        <label for="gender" class="block text-sm font-medium text-gray-700">लिङ्ग:</label>
                        <select id="gender" name="gender" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">छान्नुहोस्</option>
                            <option value="पुरुष">पुरुष</option>
                            <option value="महिला">महिला</option>
                            <option value="अन्य">अन्य</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- २. ठेगाना विवरण (Address Details) -->
            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">२. ठेगाना विवरण</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- स्थायी ठेगाना -->
                    <div class="space-y-4">
                        <h3 class="font-medium text-gray-600">स्थायी ठेगाना</h3>
                        <label for="p-province" class="block text-sm font-medium text-gray-700">प्रदेश:</label>
                        <input type="text" id="p-province" name="pProvince" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3" placeholder="जस्तै: बागमती">
                        <label for="p-district" class="block text-sm font-medium text-gray-700">जिल्ला:</label>
                        <input type="text" id="p-district" name="pDistrict" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3" placeholder="जस्तै: काठमाडौं">
                        <label for="p-municipality" class="block text-sm font-medium text-gray-700">गाउँ/नगरपालिका:</label>
                        <input type="text" id="p-municipality" name="pMunicipality" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3" placeholder="जस्तै: ललितपुर महानगरपालिका">
                        <label for="p-ward" class="block text-sm font-medium text-gray-700">वडा नं.:</label>
                        <input type="text" id="p-ward" name="pWard" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3" placeholder="जस्तै: ५">
                    </div>
                    <!-- पत्राचार गर्ने ठेगाना -->
                    <div class="space-y-4">
                        <h3 class="font-medium text-gray-600">पत्राचार गर्ने ठेगाना</h3>
                        <label for="c-province" class="block text-sm font-medium text-gray-700">प्रदेश:</label>
                        <input type="text" id="c-province" name="cProvince" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3" placeholder="जस्तै: बागमती">
                        <label for="c-district" class="block text-sm font-medium text-gray-700">जिल्ला:</label>
                        <input type="text" id="c-district" name="cDistrict" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3" placeholder="जस्तै: काठमाडौं">
                        <label for="c-municipality" class="block text-sm font-medium text-gray-700">गाउँ/नगरपालिका:</label>
                        <input type="text" id="c-municipality" name="cMunicipality" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3" placeholder="जस्तै: ललितपुर महानगरपालिका">
                        <label for="c-ward" class="block text-sm font-medium text-gray-700">वडा नं.:</label>
                        <input type="text" id="c-ward" name="cWard" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3" placeholder="जस्तै: ५">
                    </div>
                </div>
            </div>

            <!-- ३. सम्पर्क विवरण (Contact Details) -->
            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">३. सम्पर्क विवरण</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700">फोन नम्बर:</label>
                        <input type="tel" id="phone" name="phone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3" placeholder="जस्तै: ९८xxxxxxxx">
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">इमेल:</label>
                        <input type="email" id="email" name="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3" placeholder="जस्तै: example@email.com">
                    </div>
                </div>
            </div>

            <!-- ४. शैक्षिक योग्यता (Educational Qualification) -->
            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">४. शैक्षिक योग्यता</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr class="bg-gray-200">
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">शैक्षिक उपाधि</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">सम्पन्न गरेको शिक्षण संस्था</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">पास गरेको वर्ष</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">कार्यहरू</th>
                            </tr>
                        </thead>
                        <tbody id="education-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Rows will be added dynamically here -->
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 flex justify-end">
                    <button type="button" onclick="addEducationRow()" class="px-4 py-2 bg-green-500 text-white rounded-md shadow hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition">
                        शैक्षिक योग्यता थप्नुहोस्
                    </button>
                </div>
            </div>

            <!-- ५. कार्य अनुभव (Work Experience) -->
            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">५. कार्य अनुभव</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr class="bg-gray-200">
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">पद</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">कार्यालय</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">प्रकार</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">मिति देखि</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">मिति सम्म</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">अवधि</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">कार्यहरू</th>
                            </tr>
                        </thead>
                        <tbody id="experience-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Rows will be added dynamically here -->
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 flex justify-end">
                    <button type="button" onclick="addExperienceRow()" class="px-4 py-2 bg-green-500 text-white rounded-md shadow hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition">
                        कार्य अनुभव थप्नुहोस्
                    </button>
                </div>
            </div>

            <!-- ६. नागरिकता र अन्य कागजात (Citizenship & Other Documents) -->
            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">६. नागरिकता र अन्य कागजात</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="citizenship-number" class="block text-sm font-medium text-gray-700">नागरिकता नम्बर:</label>
                        <input type="text" id="citizenship-number" name="citizenshipNumber" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3" placeholder="जस्तै: ०१-०२-७६-०१२३४">
                    </div>
                    <div>
                        <label for="citizenship-district" class="block text-sm font-medium text-gray-700">नागरिकता जारी गर्ने जिल्ला:</label>
                        <input type="text" id="citizenship-district" name="citizenshipDistrict" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3" placeholder="जस्तै: काठमाडौं">
                    </div>
                    <div>
                        <label for="citizenship-date" class="block text-sm font-medium text-gray-700">नागरिकता जारी मिति (वि.सं.):</label>
                        <input type="text" id="citizenship-date" name="citizenshipDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3" placeholder="yyyy/mm/dd">
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="text-center mt-8">
                <button type="submit" class="w-full md:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-full shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50 transition transform hover:scale-105">
                    पेश गर्नुहोस्
                </button>
            </div>
        </form>

        <div id="message-box" class="mt-8 p-4 text-center text-white font-semibold rounded-lg hidden"></div>
    </div>
    
    <!-- फारम प्रिभ्यु कन्टेनर (Form Preview Container) -->
    <div id="preview-container" class="container bg-white p-8 rounded-2xl shadow-xl w-full max-w-4xl printable">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">आवेदन फारमको विवरण</h1>
            <p class="mt-2 text-gray-600">तपाईँले भरेका विवरणहरू तल दिइएका छन्।</p>
        </div>

        <div id="preview-content" class="space-y-6 text-gray-700">
            <!-- Filled form data will be rendered here by JavaScript -->
        </div>

        <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8 no-print">
            <button onclick="printForm()" class="px-6 py-2 bg-gray-600 text-white font-semibold rounded-md shadow hover:bg-gray-700 transition">फारम प्रिन्ट गर्नुहोस्</button>
            <button onclick="showAdmitCard()" class="px-6 py-2 bg-yellow-600 text-white font-semibold rounded-md shadow hover:bg-yellow-700 transition">प्रवेश पत्र देखाउनुहोस्</button>
            <button onclick="goBackToForm()" class="px-6 py-2 bg-red-600 text-white font-semibold rounded-md shadow hover:bg-red-700 transition">पछाडि जानुहोस्</button>
        </div>
    </div>

    <!-- प्रवेश पत्र कन्टेनर (Admit Card Container) -->
    <div id="admit-card-container" class="container bg-white p-8 rounded-2xl shadow-xl w-full max-w-lg printable">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">प्रवेश पत्र</h1>
            <p class="mt-2 text-gray-600">परीक्षा केन्द्रमा अनिवार्य रूपमा यो प्रवेश पत्र लिएर जानुहोला।</p>
        </div>

        <div id="admit-card-content" class="space-y-4 text-gray-700">
            <!-- Admit card data will be rendered here by JavaScript -->
        </div>

        <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8 no-print">
            <button onclick="printAdmitCard()" class="px-6 py-2 bg-gray-600 text-white font-semibold rounded-md shadow hover:bg-gray-700 transition">प्रवेश पत्र प्रिन्ट गर्नुहोस्</button>
            <button onclick="goBackToPreview()" class="px-6 py-2 bg-red-600 text-white font-semibold rounded-md shadow hover:bg-red-700 transition">पछाडि जानुहोस्</button>
        </div>
    </div>


    <script>
        // Function to convert Bikram Sambat date (yyyy/mm/dd) to JavaScript Date object
        // NOTE: This is a simplified placeholder and not a full conversion library.
        function bsToDate(bsDate) {
            const parts = bsDate.split('/').map(Number);
            if (parts.length !== 3 || parts.some(isNaN)) return null;

            const [year, month, day] = parts;
            // A very rough approximation for calculation. A real app would use a library like 'nepali-date-converter'.
            const adYear = year - 56;
            const adMonth = month - 8;
            const adDay = day - 17;
            const adDate = new Date(adYear, adMonth, adDay);
            return adDate;
        }

        // Function to calculate duration between two Bikram Sambat dates
        function calculateDuration(fromBs, toBs) {
            if (!fromBs || !toBs) return "० वर्ष ० महिना";

            const fromDate = bsToDate(fromBs);
            const toDate = bsToDate(toBs);

            if (!fromDate || !toDate || fromDate > toDate) {
                return "अमान्य मिति";
            }

            let years = toDate.getFullYear() - fromDate.getFullYear();
            let months = toDate.getMonth() - fromDate.getMonth();
            let days = toDate.getDate() - fromDate.getDate();

            if (days < 0) {
                months--;
                days += new Date(toDate.getFullYear(), toDate.getMonth(), 0).getDate();
            }

            if (months < 0) {
                years--;
                months += 12;
            }
            
            return `${years} वर्ष ${months} महिना`;
        }

        // Function to add a new row to the Education table
        function addEducationRow() {
            const tableBody = document.getElementById('education-table-body');
            const newRow = document.createElement('tr');
            newRow.classList.add('hover:bg-gray-100');

            newRow.innerHTML = `
                <td class="px-6 py-4 table-data-center"><input type="text" class="w-full p-2 border rounded-md" name="educationDegree[]" placeholder="शैक्षिक उपाधि"></td>
                <td class="px-6 py-4 table-data-center"><input type="text" class="w-full p-2 border rounded-md" name="educationInstitution[]" placeholder="शिक्षण संस्था"></td>
                <td class="px-6 py-4 table-data-center"><input type="text" class="w-full p-2 border rounded-md" name="educationYear[]" placeholder="२०७५"></td>
                <td class="px-6 py-4 table-cell-actions table-data-center">
                    <button type="button" onclick="removeRow(this)" class="px-3 py-1 bg-red-500 text-white rounded-md text-sm hover:bg-red-600 transition">हटाउनुहोस्</button>
                </td>
            `;
            tableBody.appendChild(newRow);
        }

        // Function to add a new row to the Work Experience table
        function addExperienceRow() {
            const tableBody = document.getElementById('experience-table-body');
            const newRow = document.createElement('tr');
            newRow.classList.add('hover:bg-gray-100');

            newRow.innerHTML = `
                <td class="px-6 py-4 table-data-center"><input type="text" class="w-full p-2 border rounded-md" name="expPosition[]" placeholder="पद"></td>
                <td class="px-6 py-4 table-data-center"><input type="text" class="w-full p-2 border rounded-md" name="expOffice[]" placeholder="कार्यालय"></td>
                <td class="px-6 py-4 table-data-center">
                    <select class="w-full p-2 border rounded-md" name="expType[]">
                        <option value="स्थायी">स्थायी</option>
                        <option value="अस्थायी">अस्थायी</option>
                        <option value="करार">करार</option>
                    </select>
                </td>
                <td class="px-6 py-4 table-data-center"><input type="text" class="w-full p-2 border rounded-md from-date" name="expFrom[]" placeholder="yyyy/mm/dd" oninput="updateDuration(this)"></td>
                <td class="px-6 py-4 table-data-center"><input type="text" class="w-full p-2 border rounded-md to-date" name="expTo[]" placeholder="yyyy/mm/dd" oninput="updateDuration(this)"></td>
                <td class="px-6 py-4 table-data-center"><input type="text" class="w-full p-2 border rounded-md duration-field" name="expDuration[]" readonly value="० वर्ष ० महिना"></td>
                <td class="px-6 py-4 table-cell-actions table-data-center">
                    <button type="button" onclick="removeRow(this)" class="px-3 py-1 bg-red-500 text-white rounded-md text-sm hover:bg-red-600 transition">हटाउनुहोस्</button>
                </td>
            `;
            tableBody.appendChild(newRow);
        }

        // Function to update the duration field when 'from' or 'to' dates change
        function updateDuration(input) {
            const row = input.closest('tr');
            const fromDateInput = row.querySelector('.from-date');
            const toDateInput = row.querySelector('.to-date');
            const durationInput = row.querySelector('.duration-field');

            const fromDate = fromDateInput.value;
            const toDate = toDateInput.value;

            durationInput.value = calculateDuration(fromDate, toDate);
        }

        // Function to remove a row from a table
        function removeRow(button) {
            button.closest('tr').remove();
        }

        // Function to show a specific container and hide others
        function showContainer(containerId) {
            const containers = document.querySelectorAll('.container, #form-container');
            containers.forEach(container => container.classList.remove('active-container'));
            document.getElementById(containerId).classList.add('active-container');
        }

        // Function to generate and display form preview
        function generatePreview(data) {
            const previewContent = document.getElementById('preview-content');
            previewContent.innerHTML = ''; // Clear previous content

            // HTML for the form preview
            let html = `
                <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">व्यक्तिगत विवरण</h2>
                    <p><strong>नाम:</strong> ${data.fullName || ''}</p>
                    <p><strong>Name (Eng):</strong> ${data.fullNameEn || ''}</p>
                    <p><strong>जन्म मिति:</strong> ${data.dob || ''}</p>
                    <p><strong>लिङ्ग:</strong> ${data.gender || ''}</p>
                </div>
                <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">ठेगाना विवरण</h2>
                    <p><strong>स्थायी ठेगाना:</strong> ${data.pProvince || ''}, ${data.pDistrict || ''}, ${data.pMunicipality || ''}, वडा नं. ${data.pWard || ''}</p>
                    <p><strong>पत्राचार गर्ने ठेगाना:</strong> ${data.cProvince || ''}, ${data.cDistrict || ''}, ${data.cMunicipality || ''}, वडा नं. ${data.cWard || ''}</p>
                </div>
                <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">सम्पर्क विवरण</h2>
                    <p><strong>फोन नम्बर:</strong> ${data.phone || ''}</p>
                    <p><strong>इमेल:</strong> ${data.email || ''}</p>
                </div>
                <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">शैक्षिक योग्यता</h2>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr class="bg-gray-200">
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">शैक्षिक उपाधि</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">सम्पन्न गरेको शिक्षण संस्था</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">पास गरेको वर्ष</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${(data.educationDegree || []).map((degree, index) => `
                                <tr>
                                    <td class="px-6 py-4 table-data-center">${degree}</td>
                                    <td class="px-6 py-4 table-data-center">${data.educationInstitution[index]}</td>
                                    <td class="px-6 py-4 table-data-center">${data.educationYear[index]}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">कार्य अनुभव</h2>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr class="bg-gray-200">
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">पद</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">कार्यालय</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">प्रकार</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">मिति देखि</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">मिति सम्म</th>
                                <th class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider table-header-center">अवधि</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${(data.expPosition || []).map((position, index) => `
                                <tr>
                                    <td class="px-6 py-4 table-data-center">${position}</td>
                                    <td class="px-6 py-4 table-data-center">${data.expOffice[index]}</td>
                                    <td class="px-6 py-4 table-data-center">${data.expType[index]}</td>
                                    <td class="px-6 py-4 table-data-center">${data.expFrom[index]}</td>
                                    <td class="px-6 py-4 table-data-center">${data.expTo[index]}</td>
                                    <td class="px-6 py-4 table-data-center">${data.expDuration[index]}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">नागरिकता विवरण</h2>
                    <p><strong>नागरिकता नम्बर:</strong> ${data.citizenshipNumber || ''}</p>
                    <p><strong>जारी गर्ने जिल्ला:</strong> ${data.citizenshipDistrict || ''}</p>
                    <p><strong>जारी मिति:</strong> ${data.citizenshipDate || ''}</p>
                </div>
            `;
            previewContent.innerHTML = html;
            showContainer('preview-container');
        }

        // Function to generate and display the admit card
        function generateAdmitCard(data) {
            const admitCardContent = document.getElementById('admit-card-content');
            admitCardContent.innerHTML = '';

            let html = `
                <div class="border-2 border-gray-400 p-6 rounded-lg text-center">
                    <p class="text-xl font-bold">सामाजिक सुरक्षा कोष</p>
                    <p class="text-lg">प्रवेश पत्र</p>
                    <hr class="my-4 border-gray-300">
                    <div class="space-y-2 text-left">
                        <p><strong>आवेदकको नाम:</strong> ${data.fullName || ''}</p>
                        <p><strong>जन्म मिति:</strong> ${data.dob || ''}</p>
                        <p><strong>नागरिकता नं:</strong> ${data.citizenshipNumber || ''}</p>
                        <p><strong>परीक्षा केन्द्र:</strong> सामाजिक सुरक्षा कोष, कार्यालय</p>
                        <p><strong>मिति:</strong> (परीक्षाको मिति)</p>
                    </div>
                </div>
            `;
            admitCardContent.innerHTML = html;
            showContainer('admit-card-container');
        }

        // Function to go back to the form
        function goBackToForm() {
            showContainer('form-container');
        }
        
        // Function to go back from admit card to preview
        function goBackToPreview() {
            showContainer('preview-container');
        }
        
        // Function to show the admit card from the preview
        function showAdmitCard() {
            // Re-use the collected form data
            const formData = new FormData(document.getElementById('social-security-form'));
            const data = {};
            formData.forEach((value, key) => data[key] = value);
            generateAdmitCard(data);
        }

        // Function to print the form preview
        function printForm() {
            window.print();
        }
        
        // Function to print the admit card
        function printAdmitCard() {
            window.print();
        }

        document.getElementById('social-security-form').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevents form from submitting normally

            const formData = new FormData(event.target);
            const data = {};
            // Collect all form data including dynamic rows
            formData.forEach((value, key) => {
                if (key.includes('[]')) {
                    const cleanKey = key.replace('[]', '');
                    if (!data[cleanKey]) {
                        data[cleanKey] = [];
                    }
                    data[cleanKey].push(value);
                } else {
                    data[key] = value;
                }
            });

            generatePreview(data);
        });

        // Initialize with one row for each table
        addEducationRow();
        addExperienceRow();
    </script>
</body>
</html>
