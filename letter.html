
<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§≠‡§§‡•ç‡§§‡§æ ‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß‡•Ä ‡§™‡§§‡•ç‡§∞</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for A4 paper layout */
        body {
            font-family: 'Inter', sans-serif; /* Default font, browser will fallback for Nepali */
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .container-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        .form-container, .a4-paper {
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            border-radius: 0.5rem; /* Rounded corners */
        }
        .form-container {
            width: 80%; /* Adjust width for form */
            max-width: 600px;
            padding: 20px;
        }
        .a4-paper {
            width: 210mm; /* A4 width (portrait) for screen view */
            min-height: 297mm; /* A4 height (portrait) for screen view */
            padding: 25mm; /* Standard A4 margins */
            display: flex;
            flex-direction: column;
        }
        input[type="text"], textarea, select {
            border: none;
            border-bottom: 1px dashed #000;
            outline: none;
            padding: 2px 0;
            font-size: inherit;
            font-family: inherit;
            width: auto; /* Allow input to size based on content or flex */
            min-width: 50px; /* Minimum width for inputs */
            text-align: left;
            background-color: transparent; /* Ensure background is transparent */
            border-radius: 0; /* Remove rounded corners for inputs */
        }
        input[type="text"]:focus, textarea:focus, select:focus {
            border-bottom: 1px solid #3B82F6; /* Highlight on focus */
        }
        /* Style for readonly/disabled inputs */
        input[readonly], input[disabled] {
            background-color: #f9f9f9;
            color: #555;
            border-bottom: 1px solid #ccc; /* Solid line for readonly */
        }

        /* Hide input borders and print button when printing */
        @media print {
            body {
                background-color: white;
                margin: 0;
                padding: 0;
            }
            .container-wrapper {
                flex-direction: column;
                align-items: center;
                gap: 0;
            }
            .form-container, .print-button-container, .back-button-container {
                display: none !important; /* Hide form, print, and back button */
            }
            .a4-paper {
                box-shadow: none;
                margin: 0;
                padding: 25mm; /* Maintain print margins */
                min-height: auto; /* Adjust height for print */
                /* Landscape orientation for print */
                width: 297mm !important; /* A4 Landscape width */
                height: 210mm !important; /* A4 Landscape height */
                /* Ensure content fits within the landscape page */
                transform-origin: top left;
                transform: rotate(0deg); /* Reset rotation if any */
            }
            input[type="text"], textarea, select {
                border-bottom: none; /* Hide dashed line on print */
            }
            /* Ensure text aligns correctly in printed letter */
            .letter-content-text span {
                display: inline; /* Ensure spans don't break lines */
            }
            .letter-header-center {
                text-align: center;
            }
            /* Ensure logo is visible when printing */
            .logo-container {
                display: flex !important; /* Ensure the container is a flex container */
                align-items: center !important; /* Vertically align image if needed */
                justify-content: flex-start !important; /* Align to start */
                width: auto !important; /* Allow it to take natural width */
                visibility: visible !important;
                margin-right: 20px !important; /* Ensure margin is applied on print too */
            }
            .logo-container img {
                display: block !important;
                visibility: visible !important;
                width: 80px !important; /* Updated fixed size for print */
                height: 80px !important; /* Updated fixed size for print */
            }
        }
        .flex-grow-1 { flex-grow: 1; }
        .flex-grow-2 { flex-grow: 2; }
        .flex-grow-3 { flex-grow: 3; }
        .flex-grow-4 { flex-grow: 4; }
        .flex-grow-5 { flex-grow: 5; }
        .required-field::after {
            content: '*';
            color: red;
            margin-left: 4px;
        }
        .text-justify {
            text-align: justify;
        }
        /* Adjust logo container for left alignment */
        .logo-container {
            display: flex;
            justify-content: flex-start; /* Align logo to the left */
            width: auto; /* Take only necessary width */
            margin-right: 20px; /* Space between logo and text */
        }
        .header-text-container {
            flex-grow: 1; /* Allow text container to take available space */
            text-align: center; /* Center the text within its container */
        }
        /* Custom spacing for Chalan No. and Sa.Su. Patra No. */
        .chalan-sasu-line {
            display: flex;
            align-items: center;
            justify-content: flex-start; /* Ensure left alignment */
            gap: 1cm; /* Approximately 1cm gap */
        }
        .chalan-sasu-line > div {
            display: flex;
            align-items: center;
        }
        .patra-sankhya-label, .miti-label, .chalan-no-label, .sasu-patra-no-label, .province-address {
            color: red;
            font-weight: bold;
        }
        .patra-sankhya-value, .miti-value, .chalan-no-value, .sasu-patra-no-value {
            color: black;
        }
        .signature-block {
            text-align: right; /* Align the entire block to the right */
            width: 100%; /* Take full width to allow internal centering */
            display: flex; /* Use flexbox for internal alignment */
            flex-direction: column; /* Stack items vertically */
            align-items: flex-end; /* Align all items to the right */
        }
        .signature-block p {
            width: 200px; /* Fixed width for signature elements */
            text-align: center; /* Center text within their fixed width */
        }
        .signature-line {
            display: block; /* Ensure it takes full width of its container */
        }
        /* Increased font size for office name */
        .office-name-display {
            font-size: 1.25rem; /* Tailwind's text-xl is 1.25rem, text-lg is 1.125rem. Making it bigger than text-lg. */
        }
    </style>
</head>
<body class="selection:bg-blue-200">
    <div class="container-wrapper">
        <!-- Input Form Section -->
        <div id="inputForm" class="form-container p-6 mb-8 rounded-lg shadow-lg">
            <h2 class="text-xl font-bold mb-6 text-center text-gray-700">‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§™‡§§‡•ç‡§∞ ‡§µ‡§ø‡§µ‡§∞‡§£</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="col-span-2">
                    <label for="officeName" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø‡§ï‡•ã ‡§®‡§æ‡§Æ:</label>
                    <input type="text" id="officeName" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£: ‡§µ‡§°‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø"/>
                </div>
                <div class="col-span-2">
                    <label for="officeAddress" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø‡§ï‡•ã ‡§†‡•á‡§ó‡§æ‡§®‡§æ:</label>
                    <input type="text" id="officeAddress" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£: ‡§π‡§ü‡§ø‡§Ø‡§æ"/>
                </div>
                <div>
                    <label for="fiscalYear" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§Ü.‡§µ. (‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑):</label>
                    <select id="fiscalYear" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">‡§Ü.‡§µ. ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>
                        <option value="‡•®‡•¶‡•≠‡•Ø/‡•Æ‡•¶">‡•®‡•¶‡•≠‡•Ø/‡•Æ‡•¶</option>
                        <option value="‡•®‡•¶‡•Æ‡•¶/‡•Æ‡•ß">‡•®‡•¶‡•Æ‡•¶/‡•Æ‡•ß</option>
                        <option value="‡•®‡•¶‡•Æ‡•ß/‡•Æ‡•®">‡•®‡•¶‡•Æ‡•ß/‡•Æ‡•®</option>
                        <option value="‡•®‡•¶‡•Æ‡•®/‡•Æ‡•©">‡•®‡•¶‡•Æ‡•®/‡•Æ‡•©</option>
                    </select>
                </div>
                <div>
                    <label for="patraSankhya" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§™‡§§‡•ç‡§∞ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ‡§É</label>
                    <input type="text" id="patraSankhya" class="w-full rounded-md px-3 py-2 border border-gray-300 bg-gray-100 text-gray-600" readonly placeholder="‡§Ü.‡§µ. ‡§õ‡§®‡•ã‡§ü ‡§ó‡§∞‡•á‡§™‡§õ‡§ø ‡§∏‡•ç‡§µ‡§§‡§É ‡§Ü‡§â‡§®‡•á‡§õ"/>
                </div>
                <div>
                    <label for="miti" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§Æ‡§ø‡§§‡§ø‡§É</label>
                    <input type="text" id="miti" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="YYYY/MM/DD (‡§µ‡§ø.‡§∏‡§Ç.)" maxlength="10"/>
                </div>
                <div class="col-span-2 flex items-center">
                    <label for="chalanNo" class="block text-gray-700 text-sm font-bold mb-1 mr-2">‡§ö.‡§®‡§Ç.:</label>
                    <input type="text" id="chalanNo" class="w-24 rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§ö‡§≤‡§æ‡§®‡•Ä ‡§®‡§Ç."/>
                    <span class="inline-block w-16 h-px bg-transparent border-b border-dashed border-gray-400 mx-2"></span> <!-- Tab space for manual writing -->
                    <!-- Removed Sa.Su. Patra No. input -->
                </div>
                <div>
                    <label for="bankName" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§¨‡•à‡§Ç‡§ï‡§ï‡•ã ‡§®‡§æ‡§Æ:</label>
                    <select id="bankName" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">‡§¨‡•à‡§Ç‡§ï ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>
                        <option value="‡§™‡•ç‡§∞‡§≠‡•Å ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø.">‡§™‡•ç‡§∞‡§≠‡•Å ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø.</option>
                        <option value="‡§®‡•á‡§™‡§æ‡§≤ ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø.">‡§®‡•á‡§™‡§æ‡§≤ ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø.</option>
                        <option value="‡§ï‡§æ‡§Æ‡§®‡§æ ‡§∏‡•á‡§µ‡§æ ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø.">‡§ï‡§æ‡§Æ‡§®‡§æ ‡§∏‡•á‡§µ‡§æ ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø.</option>
                        <option value="‡§ó‡•ç‡§≤‡•ã‡§¨‡§≤ ‡§Ü‡§á‡§è‡§Æ‡§á ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø">‡§ó‡•ç‡§≤‡•ã‡§¨‡§≤ ‡§Ü‡§á‡§è‡§Æ‡§á ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø</option>
                    </select>
                </div>
                <div>
                    <label for="wardNo" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§µ‡§°‡§æ ‡§®‡§Ç.:</label>
                    <select id="wardNo" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">‡§µ‡§°‡§æ ‡§®‡§Ç. ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>
                        <script>
                            for (let i = 1; i <= 11; i++) {
                                document.write(`<option value="${i}">${i}</option>`);
                            }
                        </script>
                    </select>
                </div>
                <div class="col-span-2">
                    <label for="ssbId" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§≠‡§§‡•ç‡§§‡§æ ‡§™‡§∞‡§ø‡§ö‡§Ø‡§™‡§§‡•ç‡§∞ ‡§®‡§Ç.:</label>
                    <input type="text" id="ssbId" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§™‡§∞‡§ø‡§ö‡§Ø‡§™‡§§‡•ç‡§∞ ‡§®‡§Ç." maxlength="13"/>
                </div>
                <div class="col-span-2">
                    <label for="personName" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§®‡§æ‡§Æ:</label>
                    <input type="text" id="personName" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§∂‡•ç‡§∞‡•Ä/‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä/‡§ï‡•Å‡§Æ‡§æ‡§∞‡•Ä"/>
                </div>
                <div>
                    <label for="deathDate" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å ‡§Æ‡§ø‡§§‡§ø:</label>
                    <input type="text" id="deathDate" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="YYYY/MM/DD (‡§µ‡§ø.‡§∏‡§Ç.)" maxlength="10"/>
                </div>
                <div>
                    <label for="deathRegDate" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å‡§¶‡§∞‡•ç‡§§‡§æ ‡§Æ‡§ø‡§§‡§ø:</label>
                    <input type="text" id="deathRegDate" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="YYYY/MM/DD (‡§µ‡§ø.‡§∏‡§Ç.)" maxlength="10"/>
                </div>
                <div>
                    <label for="quarter" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§§‡•ç‡§∞‡•à‡§Æ‡§æ‡§∏‡§ø‡§ï:</label>
                    <select id="quarter" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">‡§§‡•ç‡§∞‡•à‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>
                        <option value="‡§™‡•ç‡§∞‡§•‡§Æ">‡§™‡•ç‡§∞‡§•‡§Æ</option>
                        <option value="‡§¶‡•ã‡§∏‡•ç‡§∞‡•ã">‡§¶‡•ã‡§∏‡•ç‡§∞‡•ã</option>
                        <option value="‡§§‡•á‡§∏‡•ç‡§∞‡•ã">‡§§‡•á‡§∏‡•ç‡§∞‡•ã</option>
                        <option value="‡§ö‡•å‡§•‡•ã">‡§ö‡•å‡§•‡•ã</option>
                    </select>
                </div>
                <div>
                    <label for="amount" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§∞‡§ï‡§Æ ‡§∞‡•Å.:</label>
                    <input type="text" id="amount" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§∞‡§ï‡§Æ"/>
                </div>
                <div>
                    <label for="relationship" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß:</label>
                    <select id="relationship" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>
                        <option value="‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§æ‡§®">‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§æ‡§®</option>
                        <option value="‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä">‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä</option>
                        <option value="‡§õ‡•ã‡§∞‡§æ">‡§õ‡•ã‡§∞‡§æ</option>
                        <option value="‡§õ‡•ã‡§∞‡•Ä">‡§õ‡•ã‡§∞‡•Ä</option>
                        <option value="‡§¨‡•Å‡§π‡§æ‡§∞‡•Ä">‡§¨‡•Å‡§π‡§æ‡§∞‡•Ä</option>
                        <option value="‡§®‡§æ‡§§‡•Ä">‡§®‡§æ‡§§‡•Ä</option>
                        <option value="‡§®‡§æ‡§§‡§ø‡§®‡•Ä">‡§®‡§æ‡§§‡§ø‡§®‡•Ä</option>
                    </select>
                </div>
                <div id="relatedPersonNameContainer" class="col-span-2 hidden">
                    <label for="relatedPersonName" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß‡§ø‡§§ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï‡•ã ‡§®‡§æ‡§Æ:</label>
                    <input type="text" id="relatedPersonName" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß‡§ø‡§§ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï‡•ã ‡§®‡§æ‡§Æ"/>
                </div>
                <div>
                    <label for="citizenshipNo" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§®‡§æ.‡§™‡•ç‡§∞.‡§®‡§Ç.:</label>
                    <input type="text" id="citizenshipNo" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§®‡§æ‡§ó‡§∞‡§ø‡§ï‡§§‡§æ ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£ ‡§™‡§§‡•ç‡§∞ ‡§®‡§Ç."/>
                </div>
                <div>
                    <label for="citizenshipIssueDate" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§ú‡§æ‡§∞‡•Ä ‡§Æ‡§ø‡§§‡§ø:</label>
                    <input type="text" id="citizenshipIssueDate" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="YYYY/MM/DD (‡§µ‡§ø.‡§∏‡§Ç.)" maxlength="10"/>
                </div>
                <div>
                    <label for="remainingAmount" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§¨‡§æ‡§Å‡§ï‡•Ä ‡§∞‡§ï‡§Æ ‡§∞‡•Å.:</label>
                    <input type="text" id="remainingAmount" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§¨‡§æ‡§Å‡§ï‡•Ä ‡§∞‡§ï‡§Æ"/>
                </div>
                <div class="col-span-2">
                    <label for="remainingAmountAksharu" class="block text-gray-700 text-sm font-bold mb-1">‡§Ö‡§ï‡•ç‡§∑‡•á‡§∞‡•Å‡§™‡•Ä‡§É‡§∞‡•Å. (‡§¨‡§æ‡§Å‡§ï‡•Ä ‡§∞‡§ï‡§Æ):</label>
                    <input type="text" id="remainingAmountAksharu" class="w-full rounded-md px-3 py-2 border border-gray-300 bg-gray-100 text-gray-600" readonly placeholder="‡§Ö‡§ï‡•ç‡§∑‡•á‡§∞‡•Å‡§™‡•Ä ‡§∞‡§ï‡§Æ ‡§∏‡•ç‡§µ‡§§‡§É ‡§Ü‡§â‡§®‡•á‡§õ"/>
                </div>
                <div class="col-span-2">
                    <label for="depositAccount" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§¶‡§æ‡§ñ‡§ø‡§≤‡§æ ‡§ó‡§∞‡•ç‡§®‡•á ‡§ñ‡§æ‡§§‡§æ:</label>
                    <select id="depositAccount" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">‡§ñ‡§æ‡§§‡§æ ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>
                        <option value="‡§ï‡•ã‡§≤‡•á‡§®‡§ø‡§ï‡§æ‡§ï‡•ã ‡§¨‡§ú‡•á‡§ü ‡§ñ‡§∞‡•ç‡§ö ‡§ñ‡§æ‡§§‡§æ">‡§ï‡•ã‡§≤‡•á‡§®‡§ø‡§ï‡§æ ‡§¨‡§ú‡•á‡§ü ‡§ñ‡§∞‡•ç‡§ö ‡§ñ‡§æ‡§§‡§æ</option>
                        <option value="‡§∏‡•à‡§ò‡•Ä‡§Ø ‡§¨‡•á‡§∞‡•Å‡§ú‡•Ç ‡§ñ‡§æ‡§§‡§æ">‡§∏‡•à‡§ò‡•Ä‡§Ø ‡§¨‡•á‡§∞‡•Å‡§ú‡•Ç ‡§ñ‡§æ‡§§‡§æ</option>
                    </select>
                </div>
                <div class="col-span-2">
                    <label for="signerName" class="block text-gray-700 text-sm font-bold mb-1">‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§ó‡§∞‡•ç‡§®‡•á‡§ï‡•ã ‡§®‡§æ‡§Æ:</label>
                    <input type="text" id="signerName" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§®‡§æ‡§Æ"/>
                </div>
                <div class="col-span-2">
                    <label for="signerPost" class="block text-gray-700 text-sm font-bold mb-1">‡§™‡§¶:</label>
                    <input type="text" id="signerPost" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§™‡§¶"/>
                </div>
            </div>
            <div class="text-center mt-6">
                <button id="generateLetterBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full shadow-md transition duration-300 ease-in-out">
                    ‡§™‡§§‡•ç‡§∞ ‡§§‡§Ø‡§æ‡§∞ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç
                </button>
            </div>
            <div id="errorMessage" class="text-red-500 text-center mt-4 hidden"></div>
        </div>

        <!-- A4 Paper Letter Content Section -->
        <div id="letterContent" class="a4-paper hidden">
            <!-- Header Section -->
            <div class="flex items-start justify-between w-full mb-4">
                <!-- Logo Container -->
                <div class="logo-container">
                    <!-- ‡§®‡•á‡§™‡§æ‡§≤ ‡§∏‡§∞‡§ï‡§æ‡§∞‡§ï‡•ã ‡§≤‡•ã‡§ó‡•ã A4 ‡§ï‡§æ‡§ó‡§ú‡§ï‡•ã ‡§¨‡§æ‡§Ø‡§æ‡§Å‡§§‡§∞‡•ç‡§´ (left align) ‡§∞‡§æ‡§ñ‡•ç‡§®‡•á -->
<img src="assets/images/emblem.png" alt="‡§®‡•á‡§™‡§æ‡§≤ ‡§∏‡§∞‡§ï‡§æ‡§∞‡§ï‡•ã ‡§≤‡•ã‡§ó‡•ã" style="width: 100px; height: auto; float: left; margin-right: 20px;">
<img src="emblem.png" alt="‡§®‡•á‡§™‡§æ‡§≤ ‡§∏‡§∞‡§ï‡§æ‡§∞‡§ï‡•ã ‡§≤‡•ã‡§ó‡•ã" class="w-20 h-20">
                <div class="header-text-container flex flex-col items-center flex-grow">
                    <p class="font-bold text-lg text-red-600">‡§ó‡§≤‡§ï‡•ã‡§ü ‡§®‡§ó‡§∞‡§™‡§æ‡§≤‡§ø‡§ï‡§æ</p>
                    <p class="font-bold office-name-display text-red-600">
                        <span id="displayOfficeName"></span>&nbsp;‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø
                    </p>
                    <p class="text-sm font-bold text-black">
                        <span id="displayOfficeAddress"></span>&nbsp;, ‡§¨‡§æ‡§ó‡§≤‡•Å‡§ô
                    </p>
                </div>
            </div>

            <!-- Letter Info Section -->
            <div class="flex justify-between items-end mt-4">
                <div class="flex-grow-2">
                    <p><span class="patra-sankhya-label">‡§™‡§§‡•ç‡§∞ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ‡§É</span> <span id="displayPatraSankhya" class="w-40 patra-sankhya-value"></span>&nbsp;</p>
                    <div class="chalan-sasu-line mt-2">
                        <div>
                            <span class="chalan-no-label">‡§ö.‡§®‡§Ç.</span> <span id="displayChalanNo" class="w-40 chalan-no-value"></span>&nbsp;
                        </div>
                        <!-- Removed Sa.Su. Patra No. display -->
                    </div>
                </div>
                <div class="flex-grow-1 text-right">
                    <p class="ml-4 province-address">‡§ó‡§£‡•ç‡§°‡§ï‡•Ä ‡§™‡•ç‡§∞‡§¶‡•á‡§∂, ‡§®‡•á‡§™‡§æ‡§≤</p>
                    <p><span class="miti-label">‡§Æ‡§ø‡§§‡§ø‡§É</span> <span id="displayMiti" class="w-40 text-right miti-value"></span>&nbsp;</p>
                </div>
            </div>

            <!-- Horizontal Line -->
            <hr class="border-t border-gray-400 my-4">

            <!-- Recipient Section -->
            <div class="mt-4">
                <p>‡§∂‡•ç‡§∞‡•Ä<strong><span id="displayBankName" class="w-40"></span></strong></p>
                <p class="ml-4">‡§ó‡§≤‡§ï‡•ã‡§ü ‡§∂‡§æ‡§ñ‡§æ</p>
                <p class="ml-4">‡§ó‡§≤‡§ï‡•ã‡§ü, ‡§¨‡§æ‡§ó‡§≤‡•Å‡§ô</p>
            </div>

            <!-- Subject Section -->
            <div class="text-center my-4">
                <p class="font-bold">‡§µ‡§ø‡§∑‡§Ø‡§É ‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§≠‡§§‡•ç‡§§‡§æ ‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß‡§Æ‡§æ‡•§</p>
            </div>

            <!-- Body Section -->
            <div class="leading-relaxed letter-content-text text-justify">
                <p>
                    <span style="margin-left: 2em;"></span>‡§â‡§™‡§∞‡•ã‡§ï‡•ç‡§§ ‡§µ‡§ø‡§∑‡§Ø‡§Æ‡§æ ‡§ó‡§≤‡§ï‡•ã‡§ü ‡§®‡§ó‡§∞‡§™‡§æ‡§≤‡§ø‡§ï‡§æ ‡§µ‡§°‡§æ ‡§®‡§Ç.<span id="displayWardNo" class="w-12"></span>&nbsp;‡§®‡§ø‡§µ‡§æ‡§∏‡•Ä
                    ‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§≠‡§§‡•ç‡§§‡§æ ‡§™‡§∞‡§ø‡§ö‡§Ø‡§™‡§§‡•ç‡§∞ ‡§®‡§Ç.<span id="displaySsbId" class="w-24"></span>&nbsp;‡§≠‡§è‡§ï‡§æ ‡§∂‡•ç‡§∞‡•Ä <span id="displayPersonName" class="w-48"></span>&nbsp;‡§ï‡•ã
                    ‡§Æ‡§ø‡§§‡§ø <span id="displayDeathDate" class="w-24"></span>&nbsp;‡§Æ‡§æ ‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å ‡§≠‡§è‡§ï‡•ã ‡§∞ ‡§Æ‡§ø‡§§‡§ø<span id="displayDeathRegDate" class="w-24"></span>&nbsp;‡§Æ‡§æ
                    ‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å‡§¶‡§∞‡•ç‡§§‡§æ ‡§ó‡§∞‡•Ä ‡§≤‡§ó‡§§ ‡§ï‡§ü‡•ç‡§ü‡§æ ‡§ó‡§∞‡§ø‡§è‡§ï‡•ã ‡§π‡•Å‡§¶‡§æ‡§Å ‡§®‡§ø‡§ú ‡§ú‡§ø‡§µ‡§ø‡§§ ‡§π‡•Å‡§¶‡§æ‡§Å ‡§∏‡§Æ‡•ç‡§Æ‡§ï‡•ã ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§
                    ‡§ó‡§∞‡•ç‡§®‡•Å‡§™‡§∞‡•ç‡§®‡•á ‡§Ü.‡§µ.(<span id="displayFiscalYear" class="w-20"></span>)&nbsp;‡§ï‡•ã <span id="displayQuarter" class="w-28"></span>&nbsp;‡§§‡•ç‡§∞‡•à‡§Æ‡§æ‡§∏‡§ø‡§ï‡§ï‡•ã
                    ‡§∞‡§ï‡§Æ ‡§∞‡•Å. <span id="displayAmount" class="w-24"></span>/-&nbsp;‡§®‡§ø‡§ú‡§ï‡•ã <span id="displayRelationship" class="w-36"></span>&nbsp;<span id="displayRelatedPersonName" class="w-48"></span>&nbsp;(‡§®‡§æ.‡§™‡•ç‡§∞.‡§®‡§Ç. <span id="displayCitizenshipNo" class="w-24"></span>,&nbsp;‡§ú‡§æ‡§∞‡•Ä ‡§Æ‡§ø‡§§‡§ø<span id="displayCitizenshipIssueDate" class="w-24"></span>)‡§≤‡§æ‡§á
                    ‡§≠‡•Å‡§ï‡•ç‡§§‡§æ‡§®‡•Ä ‡§¶‡§ø‡§®‡•Å‡§π‡•Å‡§® ‡§∏‡§æ‡§•‡•à ‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å ‡§Æ‡§ø‡§§‡§ø ‡§™‡§õ‡•Ä ‡§ñ‡§æ‡§§‡§æ‡§Æ‡§æ ‡§¨‡§æ‡§Å‡§ï‡•Ä ‡§∞‡§π‡§® ‡§Ü‡§â‡§®‡•á ‡§∞‡§ï‡§Æ ‡§∞‡•Å. <span id="displayRemainingAmount" class="w-24"></span>/-
                    (‡§Ö‡§ï‡•ç‡§∑‡•á‡§∞‡•Å‡§™‡•Ä‡§É‡§∞‡•Å<span id="displayRemainingAmountAksharu" class="w-48"></span>‡§Æ‡§æ‡§§‡•ç‡§∞)&nbsp;<span id="displayDepositAccount" class="w-64"></span>‡§Æ‡§æ ‡§¶‡§æ‡§ñ‡§ø‡§≤‡§æ ‡§ó‡§∞‡§ø‡§¶‡§ø‡§®‡•Å‡§π‡•Å‡§® ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß
                    ‡§õ‡•§
                </p>
            </div>

            <!-- Signature Section -->
            <div class="signature-block mt-8">
                <p class="signature-line">.........................</p>
                <p class="font-bold"><span id="displaySignerName"></span></p>
                <p><span id="displaySignerPost"></span></p>
            </div>

            <!-- Footer Section -->
            <div class="mt-auto pt-8"> <!-- mt-auto pushes it to the bottom, pt-8 adds padding top -->
                <hr class="border-t border-gray-400 my-4"> <!-- Third horizontal line -->
            </div>
        </div>

        <!-- Print Button -->
        <div class="print-button-container fixed bottom-4 right-4 hidden"> <!-- Hidden by default -->
            <button id="printBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full shadow-lg flex items-center space-x-2">
                <span>üñ®Ô∏è</span> <span>Print</span>
            </button>
        </div>
        <!-- Back Button -->
        <div class="back-button-container fixed bottom-4 left-4 hidden">
            <button id="backBtn" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-full shadow-lg flex items-center space-x-2">
                <span>‚Ü©Ô∏è</span> <span>‡§´‡§ø‡§∞‡•ç‡§§‡§æ ‡§ú‡§æ‡§®‡•Å‡§π‡•ã‡§∏‡•ç</span>
            </button>
        </div>
    </div>

    <script>
        // Function to convert English digits to Nepali digits
        function convertEnglishToNepaliDigits(input) {
            if (typeof input !== 'string') {
                input = String(input);
            }
            const englishDigits = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
            const nepaliDigits = ['‡•¶', '‡•ß', '‡•®', '‡•©', '‡•™', '‡•´', '‡•¨', '‡•≠', '‡•Æ', '‡•Ø'];
            return input.split('').map(char => {
                const index = englishDigits.indexOf(char);
                return index !== -1 ? nepaliDigits[index] : char;
            }).join('');
        }

        // Function to convert Nepali digits to English digits
        function convertNepaliToEnglishDigits(input) {
            if (typeof input !== 'string') {
                input = String(input);
            }
            const englishDigits = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
            const nepaliDigits = ['‡•¶', '‡•ß', '‡•®', '‡•©', '‡•™', '‡•´', '‡•¨', '‡•≠', '‡•Æ', '‡•Ø'];
            return input.split('').map(char => {
                const index = nepaliDigits.indexOf(char);
                return index !== -1 ? englishDigits[index] : char;
            }).join('');
        }

        // Function to convert number to Nepali words (improved)
        function convertToNepaliWords(num) {
            num = String(num).replace(/,/g, ''); // Remove commas if any
            num = convertNepaliToEnglishDigits(num); // Convert to English digits for internal processing

            if (isNaN(num) || num === null || num === '') {
                return '';
            }
            num = Math.floor(Number(num)); // Ensure it's an integer
            if (num === 0) {
                return '‡§∂‡•Ç‡§®‡•ç‡§Ø';
            }

            const units = ['', '‡§è‡§ï', '‡§¶‡•Å‡§à', '‡§§‡•Ä‡§®', '‡§ö‡§æ‡§∞', '‡§™‡§æ‡§Å‡§ö', '‡§õ', '‡§∏‡§æ‡§§', '‡§Ü‡§†', '‡§®‡•å'];
            const teens = ['‡§¶‡§∂', '‡§è‡§ò‡§æ‡§∞', '‡§¨‡§æ‡§π‡•ç‡§∞', '‡§§‡•á‡§π‡•ç‡§∞', '‡§ö‡•å‡§ß', '‡§™‡§®‡•ç‡§ß‡•ç‡§∞', '‡§∏‡•ã‡§π‡•ç‡§∞', '‡§∏‡§§‡•ç‡§∞', '‡§Ö‡§†‡§æ‡§∞', '‡§â‡§®‡•ç‡§®‡§æ‡§á‡§∏'];
            const tens = ['', '', '‡§¨‡§ø‡§∏', '‡§§‡•Ä‡§∏', '‡§ö‡§æ‡§≤‡•Ä‡§∏', '‡§™‡§ö‡§æ‡§∏', '‡§∏‡§æ‡§†‡•Ä', '‡§∏‡§§‡•ç‡§§‡§∞‡•Ä', '‡§Ö‡§∏‡•Ä', '‡§®‡§¨‡•ç‡§¨‡•á'];
            const specialTens = {
                21: '‡§è‡§ï‡•ç‡§ï‡§æ‡§á‡§∏', 22: '‡§¨‡§æ‡§á‡§∏', 23: '‡§§‡•á‡§á‡§∏', 24: '‡§ö‡•å‡§¨‡§ø‡§∏', 25: '‡§™‡§ö‡•ç‡§ö‡§ø‡§∏', 26: '‡§õ‡§¨‡•ç‡§¨‡§ø‡§∏', 27: '‡§∏‡§§‡•ç‡§§‡§æ‡§á‡§∏', 28: '‡§Ö‡§†‡•ç‡§†‡§æ‡§á‡§∏', 29: '‡§â‡§®‡§®‡•ç‡§§‡§ø‡§∏',
                31: '‡§è‡§ï‡§§‡•Ä‡§∏', 32: '‡§¨‡§§‡•ç‡§§‡•Ä‡§∏', 33: '‡§§‡•á‡§§‡•ç‡§§‡•Ä‡§∏', 34: '‡§ö‡•å‡§Ç‡§§‡•Ä‡§∏', 35: '‡§™‡•à‡§Ç‡§§‡•Ä‡§∏', 36: '‡§õ‡§§‡•ç‡§§‡§ø‡§∏', 37: '‡§∏‡•à‡§Ç‡§§‡•Ä‡§∏', 38: '‡§Ö‡§†‡§§‡•Ä‡§∏', 39: '‡§â‡§®‡§®‡•ç‡§ö‡§æ‡§≤‡•Ä‡§∏',
                41: '‡§è‡§ï‡§ö‡§æ‡§≤‡•Ä‡§∏', 42: '‡§¨‡§Ø‡§æ‡§≤‡•Ä‡§∏', 43: '‡§§‡•ç‡§∞‡§ø‡§Ø‡§æ‡§≤‡•Ä‡§∏', 44: '‡§ö‡•å‡§µ‡§æ‡§≤‡•Ä‡§∏', 45: '‡§™‡•à‡§Ç‡§§‡§æ‡§≤‡•Ä‡§∏', 46: '‡§õ‡§Ø‡§æ‡§≤‡•Ä‡§∏', 47: '‡§∏‡§®‡•ç‡§§‡§æ‡§≤‡•Ä‡§∏', 48: '‡§Ö‡§†‡•ç‡§ö‡§æ‡§≤‡•Ä‡§∏', 49: '‡§â‡§®‡§®‡•ç‡§ö‡§æ‡§∏',
                51: '‡§è‡§ï‡§æ‡§â‡§®‡•ç‡§®', 52: '‡§¨‡§æ‡§â‡§®‡•ç‡§®', 53: '‡§§‡§ø‡§∞‡§™‡§®‡•ç‡§®', 54: '‡§ö‡•å‡§µ‡§®‡•ç‡§®', 55: '‡§™‡§ö‡§™‡§®‡•ç‡§®', 56: '‡§õ‡§™‡•ç‡§™‡§®‡•ç‡§®', 57: '‡§∏‡§®‡•ç‡§§‡§æ‡§â‡§®‡•ç‡§®', 58: '‡§Ö‡§®‡•ç‡§†‡§æ‡§â‡§®‡•ç‡§®', 59: '‡§â‡§®‡§®‡•ç‡§∏‡§æ‡§†‡•Ä',
                61: '‡§è‡§ï‡§∏‡§ü‡•ç‡§†‡•Ä', 62: '‡§¨‡§æ‡§∏‡§ü‡•ç‡§†‡•Ä', 63: '‡§§‡•ç‡§∞‡§ø‡§∏‡§ü‡•ç‡§†‡•Ä', 64: '‡§ö‡•å‡§Ç‡§∏‡§ü‡•ç‡§†‡•Ä', 65: '‡§™‡•à‡§Ç‡§∏‡§ü‡•ç‡§†‡•Ä', 66: '‡§õ‡•à‡§∏‡§ü‡•ç‡§†‡•Ä', 67: '‡§∏‡§°‡•ç‡§∏‡§ü‡•ç‡§†‡•Ä', 68: '‡§Ö‡§†‡•ç‡§∏‡§ü‡•ç‡§†‡•Ä', 69: '‡§â‡§®‡§®‡•ç‡§∏‡§§‡•ç‡§§‡§∞‡•Ä',
                71: '‡§è‡§ï‡§π‡§§‡•ç‡§§‡§∞', 72: '‡§¨‡§π‡§§‡•ç‡§§‡§∞', 73: '‡§§‡§ø‡§π‡§§‡•ç‡§§‡§∞', 74: '‡§ö‡•å‡§π‡§§‡•ç‡§§‡§∞', 75: '‡§™‡§ö‡§π‡§§‡•ç‡§§‡§∞', 76: '‡§õ‡§Ø‡§π‡§§‡•ç‡§§‡§∞', 77: '‡§∏‡§§‡§π‡§§‡•ç‡§§‡§∞', 78: '‡§Ö‡§†‡§π‡§§‡•ç‡§§‡§∞', 79: '‡§â‡§®‡§®‡•ç‡§Ö‡§∏‡•Ä',
                81: '‡§è‡§ï‡§æ‡§∏‡•Ä', 82: '‡§¨‡§Ø‡§æ‡§∏‡•Ä', 83: '‡§§‡•ç‡§∞‡§ø‡§Ø‡§æ‡§∏‡•Ä', 84: '‡§ö‡•å‡§∞‡§æ‡§∏‡•Ä', 85: '‡§™‡§ö‡§æ‡§∏‡•Ä', 86: '‡§õ‡§Ø‡§æ‡§∏‡•Ä', 87: '‡§∏‡§§‡§æ‡§∏‡•Ä', 88: '‡§Ö‡§†‡§æ‡§∏‡•Ä', 89: '‡§â‡§®‡§®‡•ç‡§®‡§¨‡•ç‡§¨‡•á',
                91: '‡§è‡§ï‡§æ‡§®‡§¨‡•ç‡§¨‡•á', 92: '‡§¨‡§Ø‡§æ‡§®‡§¨‡•ç‡§¨‡•á', 93: '‡§§‡•ç‡§∞‡§ø‡§Ø‡§æ‡§®‡§¨‡•ç‡§¨‡•á', 94: '‡§ö‡•å‡§∞‡§æ‡§®‡§¨‡•ç‡§¨‡•á', 95: '‡§™‡§®‡•ç‡§ö‡§æ‡§®‡§¨‡•ç‡§¨‡•á', 96: '‡§õ‡§Ø‡§æ‡§®‡§¨‡•ç‡§¨‡•á', 97: '‡§∏‡§®‡•ç‡§§‡§æ‡§®‡§¨‡•ç‡§¨‡•á', 98: '‡§Ö‡§®‡•ç‡§†‡§æ‡§®‡§¨‡•ç‡§¨‡•á', 99: '‡§â‡§®‡§æ‡§®‡•ç‡§∏‡§Ø'
            };

            function convertLessThanHundred(n) {
                if (specialTens[n]) {
                    return specialTens[n];
                }
                if (n < 10) {
                    return units[n];
                }
                if (n < 20) {
                    return teens[n - 10];
                }
                return tens[Math.floor(n / 10)] + (n % 10 !== 0 ? units[n % 10] : '');
            }

            function convertThreeDigits(n) {
                let s = '';
                if (n >= 100) {
                    s += units[Math.floor(n / 100)] + ' ‡§∏‡§Ø ';
                    n %= 100;
                }
                if (n > 0) {
                    s += convertLessThanHundred(n);
                }
                return s.trim();
            }

            let result = '';
            let crore = Math.floor(num / 10000000);
            num %= 10000000;
            let lakh = Math.floor(num / 100000);
            num %= 100000;
            let thousand = Math.floor(num / 1000);
            num %= 1000;

            if (crore > 0) {
                result += convertThreeDigits(crore) + ' ‡§ï‡§∞‡•ã‡§° ';
            }
            if (lakh > 0) {
                result += convertThreeDigits(lakh) + ' ‡§≤‡§æ‡§ñ ';
            }
            if (thousand > 0) {
                result += convertThreeDigits(thousand) + ' ‡§π‡§ú‡§æ‡§∞ ';
            }
            if (num > 0) {
                result += convertThreeDigits(num);
            }

            return result.trim();
        }

        // Event listener for date inputs to auto-add slashes and validate
        function setupDateInput(elementId) {
            const inputElement = document.getElementById(elementId);

            inputElement.addEventListener('input', function(event) {
                let value = this.value;
                let cursorPosition = this.selectionStart;

                // Convert any Nepali digits to English for internal processing
                value = convertNepaliToEnglishDigits(value);

                // Remove all non-digit characters
                let cleanValue = value.replace(/[^0-9]/g, '');

                let formattedValue = '';
                if (cleanValue.length > 0) {
                    // Year part (first 4 digits)
                    formattedValue += cleanValue.substring(0, 4);
                    if (cleanValue.length > 4) {
                        formattedValue += '/';
                        // Month part (next 2 digits)
                        formattedValue += cleanValue.substring(4, 6);
                        if (cleanValue.length > 6) {
                            formattedValue += '/';
                            // Day part (last 2 digits)
                            formattedValue += cleanValue.substring(6, 8);
                        }
                    }
                }

                // Convert back to Nepali digits for display in the input field
                this.value = convertEnglishToNepaliDigits(formattedValue);

                // Adjust cursor position to account for added slashes
                // This is a simplified adjustment and might not be perfect for all cases
                let newCursorPosition = cursorPosition;
                if (cursorPosition === 5 && formattedValue.charAt(4) === '/') { // After year, if slash was added
                    newCursorPosition++;
                }
                if (cursorPosition === 8 && formattedValue.charAt(7) === '/') { // After month, if slash was added
                    newCursorPosition++;
                }
                this.setSelectionRange(newCursorPosition, newCursorPosition);
            });

            // Add keypress/keydown listener to prevent invalid characters and control input
            inputElement.addEventListener('keydown', function(event) {
                // Allow backspace, delete, tab, arrow keys, home, end
                if (event.key === 'Backspace' || event.key === 'Delete' || event.key === 'Tab' ||
                    event.key.startsWith('Arrow') || event.key === 'Home' || event.key === 'End') {
                    return;
                }

                // Allow digits (0-9)
                if (!/^\d$/.test(event.key)) {
                    event.preventDefault();
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            setupDateInput('miti');
            setupDateInput('deathDate');
            setupDateInput('deathRegDate');
            setupDateInput('citizenshipIssueDate');

            // Initial auto-fill for Patra Sankhya
            const fiscalYearSelect = document.getElementById('fiscalYear');
            if (fiscalYearSelect.value) {
                const years = fiscalYearSelect.value.split('/');
                if (years.length === 2) {
                    document.getElementById('patraSankhya').value = `${years[0].slice(-2)}/${years[1].slice(-2)}`;
                }
            }

            // Event listener for relationship select
            const relationshipSelect = document.getElementById('relationship');
            const relatedPersonNameContainer = document.getElementById('relatedPersonNameContainer');
            const relatedPersonNameInput = document.getElementById('relatedPersonName');

            relationshipSelect.addEventListener('change', function() {
                if (this.value !== '') {
                    relatedPersonNameContainer.classList.remove('hidden');
                    relatedPersonNameInput.setAttribute('required', 'required');
                } else {
                    relatedPersonNameContainer.classList.add('hidden');
                    relatedPersonNameInput.removeAttribute('required');
                    relatedPersonNameInput.value = ''; // Clear value when hidden
                }
            });
        });


        document.getElementById('generateLetterBtn').addEventListener('click', function() {
            // List of required fields by their IDs and their Nepali labels
            const requiredFields = {
                'officeName': '‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø‡§ï‡•ã ‡§®‡§æ‡§Æ',
                'officeAddress': '‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø‡§ï‡•ã ‡§†‡•á‡§ó‡§æ‡§®‡§æ',
                'fiscalYear': '‡§Ü.‡§µ. (‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑)',
                'patraSankhya': '‡§™‡§§‡•ç‡§∞ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ',
                'miti': '‡§Æ‡§ø‡§§‡§ø',
                'bankName': '‡§¨‡•à‡§Ç‡§ï‡§ï‡•ã ‡§®‡§æ‡§Æ',
                'wardNo': '‡§µ‡§°‡§æ ‡§®‡§Ç.',
                'ssbId': '‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§≠‡§§‡•ç‡§§‡§æ ‡§™‡§∞‡§ø‡§ö‡§Ø‡§™‡§§‡•ç‡§∞ ‡§®‡§Ç.',
                'personName': '‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§®‡§æ‡§Æ',
                'deathDate': '‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å ‡§Æ‡§ø‡§§‡§ø',
                'deathRegDate': '‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å‡§¶‡§∞‡•ç‡§§‡§æ ‡§Æ‡§ø‡§§‡§ø',
                'quarter': '‡§§‡•ç‡§∞‡•à‡§Æ‡§æ‡§∏‡§ø‡§ï',
                'amount': '‡§∞‡§ï‡§Æ ‡§∞‡•Å.',
                'relationship': '‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß',
                'citizenshipNo': '‡§®‡§æ.‡§™‡•ç‡§∞.‡§®‡§Ç.',
                'citizenshipIssueDate': '‡§ú‡§æ‡§∞‡•Ä ‡§Æ‡§ø‡§§‡§ø',
                'remainingAmount': '‡§¨‡§æ‡§Å‡§ï‡•Ä ‡§∞‡§ï‡§Æ ‡§∞‡•Å.',
                'depositAccount': '‡§¶‡§æ‡§ñ‡§ø‡§≤‡§æ ‡§ó‡§∞‡•ç‡§®‡•á ‡§ñ‡§æ‡§§‡§æ'
            };

            let missingFields = [];
            let allFieldsValid = true;

            for (const fieldId in requiredFields) {
                const inputElement = document.getElementById(fieldId);
                if (inputElement.value.trim() === '') {
                    missingFields.push(requiredFields[fieldId]);
                    inputElement.style.borderColor = 'red'; // Highlight empty required fields
                    allFieldsValid = false;
                } else {
                    inputElement.style.borderColor = ''; // Reset border color
                }
            }

            // Validate relatedPersonName if relationship is selected
            const relationshipSelect = document.getElementById('relationship');
            const relatedPersonNameInput = document.getElementById('relatedPersonName');
            if (relationshipSelect.value !== '' && relatedPersonNameInput.value.trim() === '') {
                missingFields.push('‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß‡§ø‡§§ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï‡•ã ‡§®‡§æ‡§Æ');
                relatedPersonNameInput.style.borderColor = 'red';
                allFieldsValid = false;
            } else {
                relatedPersonNameInput.style.borderColor = '';
            }


            // SSB ID 13-digit validation
            const ssbIdInput = document.getElementById('ssbId');
            const ssbIdValue = convertNepaliToEnglishDigits(ssbIdInput.value.trim()); // Convert to English for length check
            if (ssbIdValue.length !== 13 || isNaN(ssbIdValue)) {
                if (!missingFields.includes(requiredFields['ssbId'])) { // Avoid duplicate messages if already caught as empty
                    missingFields.push(`‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§≠‡§§‡•ç‡§§‡§æ ‡§™‡§∞‡§ø‡§ö‡§Ø‡§™‡§§‡•ç‡§∞ ‡§®‡§Ç. (‡•ß‡•© ‡§Ö‡§Ç‡§ï‡§ï‡•ã ‡§π‡•Å‡§®‡•Å‡§™‡§∞‡•ç‡§õ ‡§∞ ‡§Ö‡§Ç‡§ï ‡§Æ‡§æ‡§§‡•ç‡§∞ ‡§π‡•Å‡§®‡•Å‡§™‡§∞‡•ç‡§õ)`);
                }
                ssbIdInput.style.borderColor = 'red';
                allFieldsValid = false;
            } else {
                ssbIdInput.style.borderColor = '';
            }

            // Date format and value validation (YYYY/MM/DD)
            const dateFields = ['miti', 'deathDate', 'deathRegDate', 'citizenshipIssueDate'];
            dateFields.forEach(fieldId => {
                const dateInput = document.getElementById(fieldId);
                const dateValue = convertNepaliToEnglishDigits(dateInput.value.trim()); // Convert to English for validation
                const parts = dateValue.split('/');

                if (parts.length !== 3 || parts[0].length !== 4 || parts[1].length !== 2 || parts[2].length !== 2) {
                    if (!missingFields.includes(requiredFields[fieldId])) {
                        missingFields.push(`${requiredFields[fieldId]} (‡§¢‡§æ‡§Å‡§ö‡§æ Wochenende/MM/DD ‡§π‡•Å‡§®‡•Å‡§™‡§∞‡•ç‡§õ)`);
                    }
                    dateInput.style.borderColor = 'red';
                    allFieldsValid = false;
                } else {
                    const year = parseInt(parts[0], 10);
                    const month = parseInt(parts[1], 10);
                    const day = parseInt(parts[2], 10);

                    if (isNaN(year) || isNaN(month) || isNaN(day) || month < 1 || month > 12 || day < 1 || day > 32) { // Allow up to 32 for Nepali context
                        if (!missingFields.includes(requiredFields[fieldId])) {
                            missingFields.push(`${requiredFields[fieldId]} (‡§Ö‡§µ‡•à‡§ß ‡§Æ‡§ø‡§§‡§ø: ‡§Æ‡§π‡§ø‡§®‡§æ ‡•ß-‡•ß‡•®, ‡§ó‡§§‡•á ‡•ß-‡•©‡•® ‡§π‡•Å‡§®‡•Å‡§™‡§∞‡•ç‡§õ)`);
                        }
                        dateInput.style.borderColor = 'red';
                        allFieldsValid = false;
                    } else {
                        dateInput.style.borderColor = '';
                    }
                }
            });


            const errorMessageDiv = document.getElementById('errorMessage');
            const letterContent = document.getElementById('letterContent');
            const inputForm = document.getElementById('inputForm');
            const backButtonContainer = document.querySelector('.back-button-container');
            const printButtonContainer = document.querySelector('.print-button-container');


            if (allFieldsValid) {
                errorMessageDiv.classList.add('hidden');

                // Populate letter content
                document.getElementById('displayOfficeName').textContent = document.getElementById('officeName').value;
                document.getElementById('displayOfficeAddress').textContent = document.getElementById('officeAddress').value;
                document.getElementById('displayPatraSankhya').textContent = document.getElementById('patraSankhya').value;
                document.getElementById('displayMiti').textContent = document.getElementById('miti').value;
                document.getElementById('displayChalanNo').textContent = convertEnglishToNepaliDigits(document.getElementById('chalanNo').value);
                
                // Removed displaySaSuPatra No.
                // document.getElementById('displaySaSuPatraNo').textContent = convertEnglishToNepaliDigits(document.getElementById('saSuPatraNo').value);

                document.getElementById('displayBankName').textContent = document.getElementById('bankName').value;
                document.getElementById('displayWardNo').textContent = convertEnglishToNepaliDigits(document.getElementById('wardNo').value);
                document.getElementById('displaySsbId').textContent = convertEnglishToNepaliDigits(document.getElementById('ssbId').value);
                document.getElementById('displayPersonName').textContent = document.getElementById('personName').value;
                document.getElementById('displayDeathDate').textContent = document.getElementById('deathDate').value;
                document.getElementById('displayDeathRegDate').textContent = document.getElementById('deathRegDate').value;
                document.getElementById('displayFiscalYear').textContent = document.getElementById('fiscalYear').value;
                document.getElementById('displayQuarter').textContent = document.getElementById('quarter').value;
                document.getElementById('displayAmount').textContent = convertEnglishToNepaliDigits(document.getElementById('amount').value);
                document.getElementById('displayRelationship').textContent = document.getElementById('relationship').value;
                document.getElementById('displayRelatedPersonName').textContent = document.getElementById('relatedPersonName').value; // New field
                document.getElementById('displayCitizenshipNo').textContent = convertEnglishToNepaliDigits(document.getElementById('citizenshipNo').value);
                document.getElementById('displayCitizenshipIssueDate').textContent = convertEnglishToNepaliDigits(document.getElementById('citizenshipIssueDate').value); // Convert to Nepali digits
                document.getElementById('displayRemainingAmount').textContent = convertEnglishToNepaliDigits(document.getElementById('remainingAmount').value);
                
                document.getElementById('displayRemainingAmountAksharu').textContent = document.getElementById('remainingAmountAksharu').value;
                
                document.getElementById('displayDepositAccount').textContent = document.getElementById('depositAccount').value;
                
                // Signer name and post are optional
                document.getElementById('displaySignerName').textContent = document.getElementById('signerName').value;
                document.getElementById('displaySignerPost').textContent = document.getElementById('signerPost').value;

                letterContent.classList.remove('hidden');
                inputForm.classList.add('hidden'); // Hide the form
                backButtonContainer.classList.remove('hidden'); // Show back button
                printButtonContainer.classList.remove('hidden'); // Show print button
                
            } else {
                errorMessageDiv.classList.remove('hidden');
                errorMessageDiv.innerHTML = `‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§ø‡§Æ‡•ç‡§® ‡§´‡§ø‡§≤‡•ç‡§°‡§π‡§∞‡•Ç ‡§≠‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡§µ‡§æ ‡§∏‡•Å‡§ß‡§æ‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç: <br> ${missingFields.join(', ')}‡•§`;
                letterContent.classList.add('hidden'); // Ensure letter is hidden if validation fails
                backButtonContainer.classList.add('hidden'); // Hide back button
                printButtonContainer.classList.add('hidden'); // Hide print button
            }
        });

        // Event listener for back button
        document.getElementById('backBtn').addEventListener('click', function() {
            document.getElementById('letterContent').classList.add('hidden');
            document.getElementById('inputForm').classList.remove('hidden');
            document.querySelector('.back-button-container').classList.add('hidden');
            document.querySelector('.print-button-container').classList.add('hidden'); // Hide print button when going back
        });

        // Event listener for print button
        document.getElementById('printBtn').addEventListener('click', function() {
            window.print();
        });


        // Auto-fill Patra Sankhya when Fiscal Year changes
        document.getElementById('fiscalYear').addEventListener('change', function() {
            const fiscalYear = this.value;
            const patraSankhyaInput = document.getElementById('patraSankhya');
            if (fiscalYear) {
                const years = fiscalYear.split('/');
                if (years.length === 2) {
                    const formattedPatraSankhya = `${years[0].slice(-2)}/${years[1].slice(-2)}`;
                    patraSankhyaInput.value = formattedPatraSankhya;
                } else {
                    patraSankhyaInput.value = '';
                }
            } else {
                patraSankhyaInput.value = '';
            }
        });

        // Event listener for remainingAmount to auto-fill remainingAmountAksharu
        document.getElementById('remainingAmount').addEventListener('input', function() {
            const amount = this.value;
            const words = convertToNepaliWords(amount);
            document.getElementById('remainingAmountAksharu').value = words;
        });

        // Event listener for amount input to handle Nepali/English digits for display
        document.getElementById('amount').addEventListener('input', function() {
            let value = this.value;
            // Allow both English and Nepali digits in input, but clean and display in Nepali
            let cleanValue = value.replace(/[^0-9‡•¶-‡•Ø]/g, ''); // Allow both English and Nepali digits
            this.value = convertEnglishToNepaliDigits(cleanValue); // Display in Nepali digits
        });

        // Event listener for SSB ID to handle input and display in Nepali digits
        document.getElementById('ssbId').addEventListener('input', function() {
            let value = this.value;
            let cleanValue = value.replace(/[^0-9‡•¶-‡•Ø]/g, ''); // Allow both English and Nepali digits
            this.value = convertEnglishToNepaliDigits(cleanValue); // Display in Nepali digits
        });
    </script>
</body>
</html>
