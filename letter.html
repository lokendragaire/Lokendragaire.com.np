<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§≠‡§§‡•ç‡§§‡§æ ‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß‡•Ä ‡§™‡§§‡•ç‡§∞</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for A4 paper layout */
        body {
            font-family: 'Inter', sans-serif; /* Default font, browser will fallback for Nepali */
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .container-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        .form-container, .a4-paper {
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            border-radius: 0.5rem; /* Rounded corners */
        }
        .form-container {
            width: 80%; /* Adjust width for form */
            max-width: 600px;
            padding: 20px;
        }
        .a4-paper {
            width: 210mm; /* A4 width */
            min-height: 297mm; /* A4 height */
            padding: 25mm; /* Standard A4 margins */
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Distribute space for header, body, footer */
        }
        input[type="text"], textarea, select {
            border: none;
            border-bottom: 1px dashed #000;
            outline: none;
            padding: 2px 0;
            font-size: inherit;
            font-family: inherit;
            width: auto; /* Allow input to size based on content or flex */
            min-width: 50px; /* Minimum width for inputs */
            text-align: left;
            background-color: transparent; /* Ensure background is transparent */
            border-radius: 0; /* Remove rounded corners for inputs */
        }
        input[type="text"]:focus, textarea:focus, select:focus {
            border-bottom: 1px solid #3B82F6; /* Highlight on focus */
        }
        /* Style for readonly/disabled inputs */
        input[readonly], input[disabled] {
            background-color: #f9f9f9;
            color: #555;
            border-bottom: 1px solid #ccc; /* Solid line for readonly */
        }

        /* Hide input borders and print button when printing */
        @media print {
            body {
                background-color: white;
                margin: 0;
                padding: 0;
            }
            .container-wrapper {
                flex-direction: column;
                align-items: center;
                gap: 0;
            }
            .form-container, .print-button-container {
                display: none !important; /* Hide form and print button */
            }
            .a4-paper {
                box-shadow: none;
                margin: 0;
                padding: 25mm; /* Maintain print margins */
                min-height: auto; /* Adjust height for print */
                height: 297mm; /* Ensure A4 height on print */
            }
            input[type="text"], textarea, select {
                border-bottom: none; /* Hide dashed line on print */
            }
            /* Ensure text aligns correctly in printed letter */
            .letter-content-text span {
                display: inline; /* Ensure spans don't break lines */
            }
            .letter-header-center {
                text-align: center;
            }
        }
        .flex-grow-1 { flex-grow: 1; }
        .flex-grow-2 { flex-grow: 2; }
        .flex-grow-3 { flex-grow: 3; }
        .flex-grow-4 { flex-grow: 4; }
        .flex-grow-5 { flex-grow: 5; }
        .required-field::after {
            content: '*';
            color: red;
            margin-left: 4px;
        }
        .text-justify {
            text-align: justify;
        }
        /* Adjust logo container for left alignment */
        .logo-container {
            display: flex;
            justify-content: flex-start; /* Align logo to the left */
            width: 100%; /* Take full width to allow text to center */
        }
        .header-text-container {
            flex-grow: 1; /* Allow text container to take available space */
            text-align: center; /* Center the text within its container */
        }
    </style>
</head>
<body class="selection:bg-blue-200">
    <div class="container-wrapper">
        <!-- Input Form Section -->
        <div id="inputForm" class="form-container p-6 mb-8 rounded-lg shadow-lg">
            <h2 class="text-xl font-bold mb-6 text-center text-gray-700">‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§™‡§§‡•ç‡§∞ ‡§µ‡§ø‡§µ‡§∞‡§£</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="col-span-2">
                    <label for="officeName" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø‡§ï‡•ã ‡§®‡§æ‡§Æ:</label>
                    <input type="text" id="officeName" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£: ‡§µ‡§°‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø"/>
                </div>
                <div class="col-span-2">
                    <label for="officeAddress" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø‡§ï‡•ã ‡§†‡•á‡§ó‡§æ‡§®‡§æ:</label>
                    <input type="text" id="officeAddress" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£: ‡§π‡§ü‡§ø‡§Ø‡§æ"/>
                </div>
                <div>
                    <label for="fiscalYear" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§Ü.‡§µ. (‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑):</label>
                    <select id="fiscalYear" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">‡§Ü.‡§µ. ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>
                        <option value="2079/80">2079/80</option>
                        <option value="2080/81">2080/81</option>
                        <option value="2081/82">2081/82</option>
                        <option value="2082/83">2082/83</option>
                    </select>
                </div>
                <div>
                    <label for="patraSankhya" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§™‡§§‡•ç‡§∞ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ‡§É</label>
                    <input type="text" id="patraSankhya" class="w-full rounded-md px-3 py-2 border border-gray-300 bg-gray-100 text-gray-600" readonly placeholder="‡§Ü.‡§µ. ‡§õ‡§®‡•ã‡§ü ‡§ó‡§∞‡•á‡§™‡§õ‡§ø ‡§∏‡•ç‡§µ‡§§‡§É ‡§Ü‡§â‡§®‡•á‡§õ"/>
                </div>
                <div>
                    <label for="miti" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§Æ‡§ø‡§§‡§ø‡§É</label>
                    <input type="text" id="miti" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="YYYY/MM/DD (‡§µ‡§ø.‡§∏‡§Ç.)"/>
                </div>
                <div class="col-span-2 flex items-center">
                    <label for="chalanNo" class="block text-gray-700 text-sm font-bold mb-1 mr-2">‡§ö.‡§®‡§Ç.:</label>
                    <input type="text" id="chalanNo" class="w-24 rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§ö‡§≤‡§æ‡§®‡•Ä ‡§®‡§Ç."/>
                    <span class="inline-block w-16 h-px bg-transparent border-b border-dashed border-gray-400 mx-2"></span> <!-- Tab space for manual writing -->
                    <label class="block text-gray-700 text-sm font-bold mb-1 ml-4 mr-2 required-field">‡§∏‡§æ.‡§∏‡•Å. ‡§™‡§§‡•ç‡§∞ ‡§®‡§Ç.:</label>
                    <span id="saSuPatraNoDisplay" class="w-24 rounded-md px-3 py-2 border border-gray-300 bg-gray-100 text-gray-600"></span>
                    <input type="hidden" id="saSuPatraNo" /> <!-- Hidden input to store generated value -->
                </div>
                <div>
                    <label for="bankName" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§¨‡•à‡§Ç‡§ï‡§ï‡•ã ‡§®‡§æ‡§Æ:</label>
                    <select id="bankName" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">‡§¨‡•à‡§Ç‡§ï ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>
                        <option value="‡§™‡•ç‡§∞‡§≠‡•Å ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø.">‡§™‡•ç‡§∞‡§≠‡•Å ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø.</option>
                        <option value="‡§®‡•á‡§™‡§æ‡§≤ ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø.">‡§®‡•á‡§™‡§æ‡§≤ ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø.</option>
                        <option value="‡§ï‡§æ‡§Æ‡§®‡§æ ‡§∏‡•á‡§µ‡§æ ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø.">‡§ï‡§æ‡§Æ‡§®‡§æ ‡§∏‡•á‡§µ‡§æ ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø.</option>
                        <option value="‡§ó‡•ç‡§≤‡•ã‡§¨‡§≤ ‡§Ü‡§á‡§è‡§Æ‡§á ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø">‡§ó‡•ç‡§≤‡•ã‡§¨‡§≤ ‡§Ü‡§á‡§è‡§Æ‡§á ‡§¨‡•à‡§Å‡§ï ‡§≤‡§ø</option>
                    </select>
                </div>
                <div>
                    <label for="wardNo" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§µ‡§°‡§æ ‡§®‡§Ç.:</label>
                    <select id="wardNo" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">‡§µ‡§°‡§æ ‡§®‡§Ç. ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>
                        <script>
                            for (let i = 1; i <= 11; i++) {
                                document.write(`<option value="${i}">${i}</option>`);
                            }
                        </script>
                    </select>
                </div>
                <div class="col-span-2">
                    <label for="ssbId" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§≠‡§§‡•ç‡§§‡§æ ‡§™‡§∞‡§ø‡§ö‡§Ø‡§™‡§§‡•ç‡§∞ ‡§®‡§Ç.:</label>
                    <input type="text" id="ssbId" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§™‡§∞‡§ø‡§ö‡§Ø‡§™‡§§‡•ç‡§∞ ‡§®‡§Ç."/>
                </div>
                <div class="col-span-2">
                    <label for="personName" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§®‡§æ‡§Æ:</label>
                    <input type="text" id="personName" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§∂‡•ç‡§∞‡•Ä/‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä/‡§ï‡•Å‡§Æ‡§æ‡§∞‡•Ä"/>
                </div>
                <div>
                    <label for="deathDate" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å ‡§Æ‡§ø‡§§‡§ø:</label>
                    <input type="text" id="deathDate" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="YYYY/MM/DD (‡§µ‡§ø.‡§∏‡§Ç.)"/>
                </div>
                <div>
                    <label for="deathRegDate" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å‡§¶‡§∞‡•ç‡§§‡§æ ‡§Æ‡§ø‡§§‡§ø:</label>
                    <input type="text" id="deathRegDate" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="YYYY/MM/DD (‡§µ‡§ø.‡§∏‡§Ç.)"/>
                </div>
                <div>
                    <label for="quarter" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§§‡•ç‡§∞‡•à‡§Æ‡§æ‡§∏‡§ø‡§ï:</label>
                    <select id="quarter" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">‡§§‡•ç‡§∞‡•à‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>
                        <option value="‡§™‡•ç‡§∞‡§•‡§Æ">‡§™‡•ç‡§∞‡§•‡§Æ</option>
                        <option value="‡§¶‡•ã‡§∏‡•ç‡§∞‡•ã">‡§¶‡•ã‡§∏‡•ç‡§∞‡•ã</option>
                        <option value="‡§§‡•á‡§∏‡•ç‡§∞‡•ã">‡§§‡•á‡§∏‡•ç‡§∞‡•ã</option>
                        <option value="‡§ö‡•å‡§•‡•ã">‡§ö‡•å‡§•‡•ã</option>
                    </select>
                </div>
                <div>
                    <label for="amount" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§∞‡§ï‡§Æ ‡§∞‡•Å.:</label>
                    <input type="text" id="amount" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§∞‡§ï‡§Æ"/>
                </div>
                <div>
                    <label for="relationship" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß:</label>
                    <select id="relationship" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>
                        <option value="‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§æ‡§®">‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§æ‡§®</option>
                        <option value="‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä">‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä</option>
                        <option value="‡§õ‡•ã‡§∞‡§æ">‡§õ‡•ã‡§∞‡§æ</option>
                        <option value="‡§õ‡•ã‡§∞‡•Ä">‡§õ‡•ã‡§∞‡•Ä</option>
                        <option value="‡§¨‡•Å‡§π‡§æ‡§∞‡•Ä">‡§¨‡•Å‡§π‡§æ‡§∞‡•Ä</option>
                        <option value="‡§®‡§æ‡§§‡•Ä">‡§®‡§æ‡§§‡•Ä</option>
                        <option value="‡§®‡§æ‡§§‡§ø‡§®‡•Ä">‡§®‡§æ‡§§‡§ø‡§®‡•Ä</option>
                    </select>
                </div>
                <div>
                    <label for="citizenshipNo" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§®‡§æ.‡§™‡•ç‡§∞.‡§®‡§Ç.:</label>
                    <input type="text" id="citizenshipNo" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§®‡§æ‡§ó‡§∞‡§ø‡§ï‡§§‡§æ ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£ ‡§™‡§§‡•ç‡§∞ ‡§®‡§Ç."/>
                </div>
                <div>
                    <label for="citizenshipIssueDate" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§ú‡§æ‡§∞‡•Ä ‡§Æ‡§ø‡§§‡§ø:</label>
                    <input type="text" id="citizenshipIssueDate" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="YYYY/MM/DD (‡§µ‡§ø.‡§∏‡§Ç.)"/>
                </div>
                <div>
                    <label for="remainingAmount" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§¨‡§æ‡§Å‡§ï‡•Ä ‡§∞‡§ï‡§Æ ‡§∞‡•Å.:</label>
                    <input type="text" id="remainingAmount" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§¨‡§æ‡§Å‡§ï‡•Ä ‡§∞‡§ï‡§Æ"/>
                </div>
                <div class="col-span-2">
                    <label for="remainingAmountAksharu" class="block text-gray-700 text-sm font-bold mb-1">‡§Ö‡§ï‡•ç‡§∑‡•á‡§∞‡•Å‡§™‡•Ä‡§É‡§∞‡•Å. (‡§¨‡§æ‡§Å‡§ï‡•Ä ‡§∞‡§ï‡§Æ):</label>
                    <input type="text" id="remainingAmountAksharu" class="w-full rounded-md px-3 py-2 border border-gray-300 bg-gray-100 text-gray-600" readonly placeholder="‡§Ö‡§ï‡•ç‡§∑‡•á‡§∞‡•Å‡§™‡•Ä ‡§∞‡§ï‡§Æ ‡§∏‡•ç‡§µ‡§§‡§É ‡§Ü‡§â‡§®‡•á‡§õ"/>
                </div>
                <div class="col-span-2">
                    <label for="depositAccount" class="block text-gray-700 text-sm font-bold mb-1 required-field">‡§¶‡§æ‡§ñ‡§ø‡§≤‡§æ ‡§ó‡§∞‡•ç‡§®‡•á ‡§ñ‡§æ‡§§‡§æ:</label>
                    <select id="depositAccount" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">‡§ñ‡§æ‡§§‡§æ ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>
                        <option value="‡§ï‡•ã‡§≤‡•á‡§®‡§ø‡§ï‡§æ‡§ï‡•ã ‡§¨‡§ú‡•á‡§ü ‡§ñ‡§∞‡•ç‡§ö ‡§ñ‡§æ‡§§‡§æ">‡§ï‡•ã‡§≤‡•á‡§®‡§ø‡§ï‡§æ‡§ï‡•ã ‡§¨‡§ú‡•á‡§ü ‡§ñ‡§∞‡•ç‡§ö ‡§ñ‡§æ‡§§‡§æ</option>
                        <option value="‡§∏‡•à‡§ò‡•Ä‡§Ø ‡§¨‡•á‡§∞‡•Å‡§ú‡•Ç ‡§ñ‡§æ‡§§‡§æ">‡§∏‡•à‡§ò‡•Ä‡§Ø ‡§¨‡•á‡§∞‡•Å‡§ú‡•Ç ‡§ñ‡§æ‡§§‡§æ</option>
                    </select>
                </div>
                <div class="col-span-2">
                    <label for="signerName" class="block text-gray-700 text-sm font-bold mb-1">‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§ó‡§∞‡•ç‡§®‡•á‡§ï‡•ã ‡§®‡§æ‡§Æ:</label>
                    <input type="text" id="signerName" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§®‡§æ‡§Æ"/>
                </div>
                <div class="col-span-2">
                    <label for="signerPost" class="block text-gray-700 text-sm font-bold mb-1">‡§™‡§¶:</label>
                    <input type="text" id="signerPost" class="w-full rounded-md px-3 py-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡§™‡§¶"/>
                </div>
            </div>
            <div class="text-center mt-6">
                <button id="generateLetterBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full shadow-md transition duration-300 ease-in-out">
                    ‡§™‡§§‡•ç‡§∞ ‡§§‡§Ø‡§æ‡§∞ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç
                </button>
            </div>
            <div id="errorMessage" class="text-red-500 text-center mt-4 hidden">‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§¨‡•à ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§´‡§ø‡§≤‡•ç‡§°‡§π‡§∞‡•Ç ‡§≠‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§</div>
        </div>

        <!-- A4 Paper Letter Content Section -->
        <div id="letterContent" class="a4-paper hidden">
            <!-- Header Section -->
            <div class="flex flex-col items-center justify-center mb-4 text-center letter-header-center">
                <!-- Logo Container -->
                <div class="logo-container self-start">
                    <!-- Using the uploaded image directly -->
                    <img src="uploaded:image_50bb29.png-ac6177f5-d733-483b-a6b9-392343845406" alt="Municipality Logo" class="w-16 h-16 mb-2">
                </div>
                <div class="header-text-container">
                    <p class="font-bold text-lg text-red-600">‡§ó‡§≤‡§ï‡•ã‡§ü ‡§®‡§ó‡§∞‡§™‡§æ‡§≤‡§ø‡§ï‡§æ</p>
                    <p class="text-sm text-red-600 font-bold">
                        <span id="displayOfficeName" class="text-center"></span> ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø
                    </p>
                    <p class="text-sm text-red-600 font-bold">
                        <span id="displayOfficeAddress" class="text-center"></span> , ‡§¨‡§æ‡§ó‡§≤‡•Å‡§ô
                    </p>
                </div>
            </div>

            <!-- Letter Info Section -->
            <div class="flex justify-between items-end mt-4">
                <div class="flex-grow-2">
                    <p>‡§™‡§§‡•ç‡§∞ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ‡§É <span id="displayPatraSankhya" class="w-40"></span></p>
                    <p class="mt-2 flex items-center">
                        ‡§ö.‡§®‡§Ç. <span id="displayChalanNo" class="w-40"></span>
                        <span class="inline-block w-16 h-px bg-transparent mx-2"></span> <!-- Tab space -->
                        ‡§∏‡§æ.‡§∏‡•Å. ‡§™‡§§‡•ç‡§∞ ‡§®‡§Ç. <span id="displaySaSuPatraNo" class="w-40"></span>
                    </p>
                </div>
                <div class="flex-grow-1 text-right">
                    <p>‡§Æ‡§ø‡§§‡§ø‡§É <span id="displayMiti" class="w-40 text-right"></span> <span class="ml-4">‡§ó‡§£‡•ç‡§°‡§ï‡•Ä ‡§™‡•ç‡§∞‡§¶‡•á‡§∂, ‡§®‡•á‡§™‡§æ‡§≤</span></p>
                </div>
            </div>

            <!-- Horizontal Line -->
            <hr class="border-t border-gray-400 my-4">

            <!-- Recipient Section -->
            <div class="mt-4">
                <p>‡§∂‡•ç‡§∞‡•Ä<strong><span id="displayBankName" class="w-40"></span></strong></p>
                <p class="ml-4">‡§ó‡§≤‡§ï‡•ã‡§ü ‡§∂‡§æ‡§ñ‡§æ</p>
                <p class="ml-4">‡§ó‡§≤‡§ï‡•ã‡§ü, ‡§¨‡§æ‡§ó‡§≤‡•Å‡§ô</p>
            </div>

            <!-- Subject Section -->
            <div class="text-center my-4">
                <p class="font-bold">‡§µ‡§ø‡§∑‡§Ø‡§É ‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§≠‡§§‡•ç‡§§‡§æ ‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß‡§Æ‡§æ‡•§</p>
            </div>

            <!-- Body Section -->
            <div class="leading-relaxed letter-content-text text-justify">
                <p>
                    <span style="margin-left: 2em;"></span>‡§â‡§™‡§∞‡•ã‡§ï‡•ç‡§§ ‡§µ‡§ø‡§∑‡§Ø‡§Æ‡§æ ‡§ó‡§≤‡§ï‡•ã‡§ü ‡§®‡§ó‡§∞‡§™‡§æ‡§≤‡§ø‡§ï‡§æ ‡§µ‡§°‡§æ ‡§®‡§Ç.<span id="displayWardNo" class="w-12"></span> ‡§®‡§ø‡§µ‡§æ‡§∏‡•Ä
                    ‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§≠‡§§‡•ç‡§§‡§æ ‡§™‡§∞‡§ø‡§ö‡§Ø‡§™‡§§‡•ç‡§∞ ‡§®‡§Ç.<span id="displaySsbId" class="w-24"></span>‡§≠‡§è‡§ï‡§æ ‡§∂‡•ç‡§∞‡•Ä <span id="displayPersonName" class="w-48"></span>‡§ï‡•ã
                    ‡§Æ‡§ø‡§§‡§ø <span id="displayDeathDate" class="w-24"></span>‡§Æ‡§æ ‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å ‡§≠‡§è‡§ï‡•ã ‡§∞ ‡§Æ‡§ø‡§§‡§ø<span id="displayDeathRegDate" class="w-24"></span>‡§Æ‡§æ
                    ‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å‡§¶‡§∞‡•ç‡§§‡§æ ‡§ó‡§∞‡•Ä ‡§≤‡§ó‡§§ ‡§ï‡§ü‡•ç‡§ü‡§æ ‡§ó‡§∞‡§ø‡§è‡§ï‡•ã ‡§π‡•Å‡§¶‡§æ‡§Å ‡§®‡§ø‡§ú ‡§ú‡§ø‡§µ‡§ø‡§§ ‡§π‡•Å‡§¶‡§æ‡§Å ‡§∏‡§Æ‡•ç‡§Æ‡§ï‡•ã ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§
                    ‡§ó‡§∞‡•ç‡§®‡•Å‡§™‡§∞‡•ç‡§®‡•á ‡§Ü.‡§µ.(<span id="displayFiscalYear" class="w-20"></span>) ‡§ï‡•ã <span id="displayQuarter" class="w-28"></span> ‡§§‡•ç‡§∞‡•à‡§Æ‡§æ‡§∏‡§ø‡§ï‡§ï‡•ã
                    ‡§∞‡§ï‡§Æ ‡§∞‡•Å. <span id="displayAmount" class="w-24"></span>/-‡§®‡§ø‡§ú‡§ï‡•ã <span id="displayRelationship" class="w-36"></span> (‡§®‡§æ.‡§™‡•ç‡§∞.‡§®‡§Ç. <span id="displayCitizenshipNo" class="w-24"></span>, ‡§ú‡§æ‡§∞‡•Ä ‡§Æ‡§ø‡§§‡§ø<span id="displayCitizenshipIssueDate" class="w-24"></span>)‡§≤‡§æ‡§á
                    ‡§≠‡•Å‡§ï‡•ç‡§§‡§æ‡§®‡•Ä ‡§¶‡§ø‡§®‡•Å‡§π‡•Å‡§® ‡§∏‡§æ‡§•‡•à ‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å ‡§Æ‡§ø‡§§‡§ø ‡§™‡§õ‡•Ä ‡§ñ‡§æ‡§§‡§æ‡§Æ‡§æ ‡§¨‡§æ‡§Å‡§ï‡•Ä ‡§∞‡§π‡§® ‡§Ü‡§â‡§®‡•á ‡§∞‡§ï‡§Æ ‡§∞‡•Å. <span id="displayRemainingAmount" class="w-24"></span>/-
                    (‡§Ö‡§ï‡•ç‡§∑‡•á‡§∞‡•Å‡§™‡•Ä‡§É‡§∞‡•Å<span id="displayRemainingAmountAksharu" class="w-48"></span>‡§Æ‡§æ‡§§‡•ç‡§∞) <span id="displayDepositAccount" class="w-64"></span>‡§Æ‡§æ ‡§¶‡§æ‡§ñ‡§ø‡§≤‡§æ ‡§ó‡§∞‡§ø‡§¶‡§ø‡§®‡•Å‡§π‡•Å‡§® ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß
                    ‡§õ‡•§
                </p>
            </div>

            <!-- Signature Section - Moved above footer line -->
            <div class="flex justify-end flex-col items-end mt-8">
                <p>.........................</p>
                <p><span id="displaySignerName" class="w-48 text-center"></span></p>
                <p><span id="displaySignerPost" class="w-48 text-center"></span></p>
            </div>

            <!-- Footer Section -->
            <div class="mt-auto pt-8"> <!-- mt-auto pushes it to the bottom, pt-8 adds padding top -->
                <hr class="border-t border-gray-400 my-4"> <!-- Third horizontal line -->
            </div>
        </div>

        <!-- Print Button -->
        <div class="print-button-container fixed bottom-4 right-4">
            <button id="printBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full shadow-lg flex items-center space-x-2">
                <span>üñ®Ô∏è</span> <span>Print</span>
            </button>
        </div>
    </div>

    <script>
        // Global counter for Sa.Su. Patra No. (client-side, resets on page load)
        let currentSaSuPatraNum = 0;

        // Function to convert number to Nepali words
        function convertToNepaliWords(num) {
            if (isNaN(num) || num === null || num === '') {
                return '';
            }
            num = Math.floor(Number(num)); // Ensure it's an integer
            if (num === 0) {
                return '‡§∂‡•Ç‡§®‡•ç‡§Ø';
            }

            const units = ['', '‡§è‡§ï', '‡§¶‡•Å‡§à', '‡§§‡•Ä‡§®', '‡§ö‡§æ‡§∞', '‡§™‡§æ‡§Å‡§ö', '‡§õ', '‡§∏‡§æ‡§§', '‡§Ü‡§†', '‡§®‡•å'];
            const teens = ['‡§¶‡§∂', '‡§è‡§ò‡§æ‡§∞', '‡§¨‡§æ‡§π‡•ç‡§∞', '‡§§‡•á‡§π‡•ç‡§∞', '‡§ö‡•å‡§ß', '‡§™‡§®‡•ç‡§ß‡•ç‡§∞', '‡§∏‡•ã‡§π‡•ç‡§∞', '‡§∏‡§§‡•ç‡§∞', '‡§Ö‡§†‡§æ‡§∞', '‡§â‡§®‡•ç‡§®‡§æ‡§á‡§∏'];
            const tens = ['', '', '‡§¨‡§ø‡§∏', '‡§§‡•Ä‡§∏', '‡§ö‡§æ‡§≤‡•Ä‡§∏', '‡§™‡§ö‡§æ‡§∏', '‡§∏‡§æ‡§†‡•Ä', '‡§∏‡§§‡•ç‡§§‡§∞‡•Ä', '‡§Ö‡§∏‡•Ä', '‡§®‡§¨‡•ç‡§¨‡•á'];

            function convertLessThanThousand(n) {
                let s = '';
                if (n >= 100) {
                    s += units[Math.floor(n / 100)] + ' ‡§∏‡§Ø ';
                    n %= 100;
                }
                if (n >= 20) {
                    s += tens[Math.floor(n / 10)] + ' ';
                    n %= 10;
                }
                if (n >= 10) {
                    s += teens[n - 10] + ' ';
                    n = 0;
                }
                if (n > 0) {
                    s += units[n] + ' ';
                }
                return s.trim();
            }

            let result = '';
            let crore = Math.floor(num / 10000000); // 1 Crore = 10,000,000
            num %= 10000000;
            let lakh = Math.floor(num / 100000); // 1 Lakh = 100,000
            num %= 100000;
            let thousand = Math.floor(num / 1000); // 1 Thousand = 1,000
            num %= 1000;

            if (crore > 0) {
                result += convertLessThanThousand(crore) + ' ‡§ï‡§∞‡•ã‡§° ';
            }
            if (lakh > 0) {
                result += convertLessThanThousand(lakh) + ' ‡§≤‡§æ‡§ñ ';
            }
            if (thousand > 0) {
                result += convertLessThanThousand(thousand) + ' ‡§π‡§ú‡§æ‡§∞ ';
            }
            if (num > 0) {
                result += convertLessThanThousand(num);
            }

            return result.trim();
        }

        // Function to get approximate current Nepali date (BS)
        // This is a simplified approximation and may not be perfectly accurate for all dates.
        // For precise conversion, a dedicated Nepali calendar library is recommended.
        function getApproxNepaliDate() {
            const today = new Date();
            const yearAD = today.getFullYear();
            const monthAD = today.getMonth() + 1; // getMonth() is 0-indexed
            const dayAD = today.getDate();

            // A very rough offset from AD to BS (e.g., 2024 AD is roughly 2081 BS)
            // This offset varies slightly throughout the year.
            let yearBS = yearAD + 56;
            let monthBS = monthAD;
            let dayBS = dayAD;

            // Simple adjustment for month/day to align with typical Nepali calendar start (e.g., Baisakh 1)
            // This is still highly approximate.
            if (monthAD < 4 || (monthAD === 4 && dayAD < 14)) { // Roughly before Baisakh 1st
                yearBS -= 1;
            }

            // Format to YYYY/MM/DD
            const formattedMonthBS = String(monthBS).padStart(2, '0');
            const formattedDayBS = String(dayBS).padStart(2, '0');

            return `${yearBS}/${formattedMonthBS}/${formattedDayBS}`;
        }

        // Set initial Nepali date on page load
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('miti').value = getApproxNepaliDate();
        });


        document.getElementById('generateLetterBtn').addEventListener('click', function() {
            // List of required fields by their IDs (chalanNo, signerName, signerPost are not required)
            const requiredFields = [
                'officeName', 'officeAddress', 'patraSankhya', 'miti',
                'bankName', 'wardNo', 'ssbId', 'personName', 'deathDate', 'deathRegDate',
                'fiscalYear', 'quarter', 'amount', 'relationship', 'citizenshipNo',
                'citizenshipIssueDate', 'remainingAmount', 'depositAccount'
            ];

            let allFieldsFilled = true;
            requiredFields.forEach(fieldId => {
                const inputElement = document.getElementById(fieldId);
                // Check if the element has 'required-field' class and is empty
                if (inputElement.classList.contains('required-field') && inputElement.value.trim() === '') {
                    allFieldsFilled = false;
                    inputElement.style.borderColor = 'red'; // Highlight empty required fields
                } else {
                    inputElement.style.borderColor = ''; // Reset border color
                }
            });

            const errorMessage = document.getElementById('errorMessage');
            const letterContent = document.getElementById('letterContent');
            const inputForm = document.getElementById('inputForm');

            if (allFieldsFilled) {
                errorMessage.classList.add('hidden');

                // Generate Sa.Su. Patra No.
                currentSaSuPatraNum++;
                if (currentSaSuPatraNum > 200) {
                    currentSaSuPatraNum = 1; // Reset if exceeds 200
                }
                const formattedSaSuNum = String(currentSaSuPatraNum).padStart(3, '0');
                document.getElementById('saSuPatraNoDisplay').textContent = formattedSaSuNum;
                document.getElementById('saSuPatraNo').value = formattedSaSuNum; // Store in hidden input

                // Populate letter content
                document.getElementById('displayOfficeName').textContent = document.getElementById('officeName').value;
                document.getElementById('displayOfficeAddress').textContent = document.getElementById('officeAddress').value;
                document.getElementById('displayPatraSankhya').textContent = document.getElementById('patraSankhya').value;
                document.getElementById('displayMiti').textContent = document.getElementById('miti').value;
                document.getElementById('displayChalanNo').textContent = document.getElementById('chalanNo').value;
                
                document.getElementById('displaySaSuPatraNo').textContent = document.getElementById('saSuPatraNo').value;

                document.getElementById('displayBankName').textContent = document.getElementById('bankName').value;
                document.getElementById('displayWardNo').textContent = document.getElementById('wardNo').value;
                document.getElementById('displaySsbId').textContent = document.getElementById('ssbId').value;
                document.getElementById('displayPersonName').textContent = document.getElementById('personName').value;
                document.getElementById('displayDeathDate').textContent = document.getElementById('deathDate').value;
                document.getElementById('displayDeathRegDate').textContent = document.getElementById('deathRegDate').value;
                document.getElementById('displayFiscalYear').textContent = document.getElementById('fiscalYear').value;
                document.getElementById('displayQuarter').textContent = document.getElementById('quarter').value;
                document.getElementById('displayAmount').textContent = document.getElementById('amount').value;
                document.getElementById('displayRelationship').textContent = document.getElementById('relationship').value;
                document.getElementById('displayCitizenshipNo').textContent = document.getElementById('citizenshipNo').value;
                document.getElementById('displayCitizenshipIssueDate').textContent = document.getElementById('citizenshipIssueDate').value;
                document.getElementById('displayRemainingAmount').textContent = document.getElementById('remainingAmount').value;
                
                document.getElementById('displayRemainingAmountAksharu').textContent = document.getElementById('remainingAmountAksharu').value;
                
                document.getElementById('displayDepositAccount').textContent = document.getElementById('depositAccount').value;
                
                // Signer name and post are optional
                document.getElementById('displaySignerName').textContent = document.getElementById('signerName').value;
                document.getElementById('displaySignerPost').textContent = document.getElementById('signerPost').value;

                letterContent.classList.remove('hidden');
                inputForm.classList.add('hidden'); // Hide the form

                // Automatically trigger print dialog
                window.print();
            } else {
                errorMessage.classList.remove('hidden');
                letterContent.classList.add('hidden'); // Ensure letter is hidden if validation fails
            }
        });

        // Auto-fill Patra Sankhya when Fiscal Year changes
        document.getElementById('fiscalYear').addEventListener('change', function() {
            const fiscalYear = this.value;
            const patraSankhyaInput = document.getElementById('patraSankhya');
            if (fiscalYear) {
                const years = fiscalYear.split('/');
                if (years.length === 2) {
                    const formattedPatraSankhya = `${years[0].slice(-2)}/${years[1].slice(-2)}`;
                    patraSankhyaInput.value = formattedPatraSankhya;
                } else {
                    patraSankhyaInput.value = '';
                }
            } else {
                patraSankhyaInput.value = '';
            }
        });

        // Event listener for remainingAmount to auto-fill remainingAmountAksharu
        document.getElementById('remainingAmount').addEventListener('input', function() {
            const amount = this.value;
            const words = convertToNepaliWords(amount);
            document.getElementById('remainingAmountAksharu').value = words;
        });
    </script>
</body>
</html>
