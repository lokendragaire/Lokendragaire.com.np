<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Source of Income Verification Letter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 5px;
        }
        .container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 15px;
            width: 100%;
            max-width: 800px;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        .form-section, .preview-section {
            display: none;
        }
        .form-section.active {
            display: block;
        }
        .preview-section.active {
            display: block;
        }
        /* A4 size and margin for printing */
        @media print {
            body {
                background: none;
                margin: 0;
                padding: 0;
            }
            .container {
                box-shadow: none;
                border-radius: 0;
                width: 210mm;
                min-height: 297mm;
                margin: 0 auto;
                padding-left: 0.7in;
                padding-right: 0.7in;
                page-break-after: always;
                position: relative;
            }
            .form-section, .buttons-container {
                display: none !important;
            }
            .preview-section {
                display: block !important;
                position: relative;
            }
            .letter-content {
                position: relative;
                z-index: 10;
                text-align: justify;
                hyphens: auto;
            }
            .watermark {
                display: block !important;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 80%;
                height: auto;
                opacity: 0.08 !important;
                pointer-events: none;
                z-index: 1;
            }
            .dotted-line-bottom {
                border-bottom: 1px dotted #999 !important;
                text-align: initial !important;
            }
            .no-wrap {
                white-space: nowrap;
            }
            .black-line {
                border-bottom: 1px solid black !important;
            }
            .red-text {
                color: red !important;
            }
            .bold-text {
                font-weight: bold;
            }
            .signature-line {
                display: block;
                border-bottom: 1px dotted black;
                width: 150px;
                margin: 0 auto 5px;
            }
            .signature-container {
                display: flex;
                flex-direction: column;
                align-items: flex-end;
            }
            p.indent {
                text-indent: 40px; /* Optional: adds indentation to paragraphs for better readability */
            }
        }
        /* Watermark styling */
        .watermark-container {
            position: relative;
            min-height: 500px;
        }
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: auto;
            opacity: 0.08;
            pointer-events: none;
            z-index: 1;
        }
        .letter-content {
            position: relative;
            z-index: 10;
        }
        /* Custom styles for dotted lines and layout */
        .dotted-line-bottom {
            border-bottom: 1px dotted #999;
            padding-bottom: 2px;
            display: inline-block;
            text-align: left;
            box-sizing: border-box;
            margin-left: 1px;
            margin-right: 1px;
            flex-grow: 1;
            flex-shrink: 1;
            white-space: nowrap;
        }
        .dotted-table {
            border-collapse: collapse;
            width: 100%;
        }
        .dotted-table th, .dotted-table td {
            border: 1px dotted #999;
            padding: 8px;
            text-align: left;
        }
        .dotted-table th {
            background-color: #f2f2f2;
        }
        .black-line {
            border-bottom: 1px solid black;
            margin-top: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="formSection" class="form-section active">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-8">Source of Income Verification Details</h2>
            <form id="letterForm" class="space-y-6">
                <h3 class="text-xl font-bold mt-8">Office Details</h3>
                <div>
                    <label for="municipalityName" class="block text-sm font-medium text-gray-700">Municipality Name:</label>
                    <input type="text" id="municipalityName" name="municipalityName" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="e.g., Galkot Municipality">
                </div>
                <div>
                    <label for="wardOfficeName" class="block text-sm font-medium text-gray-700">Ward Office Name (e.g., 8 No. Ward Office):</label>
                    <input type="text" id="wardOfficeName" name="wardOfficeName" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="e.g., 8 No. Ward Office">
                </div>
                <div>
                    <label for="officeAddress" class="block text-sm font-medium text-gray-700">Office Address (e.g., Kandebas, Baglung):</label>
                    <input type="text" id="officeAddress" name="officeAddress" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="e.g., Kandebas, Baglung">
                </div>
                <div>
                    <label for="fiscalYear" class="block text-sm font-medium text-gray-700">Fiscal Year:</label>
                    <input type="text" id="fiscalYear" name="fiscalYear" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="e.g., 2082/083">
                </div>
                <div>
                    <label for="refNo" class="block text-sm font-medium text-gray-700">Ref. No.:</label>
                    <input type="text" id="refNo" name="refNo" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="e.g., 45">
                </div>
                <div>
                    <label for="date" class="block text-sm font-medium text-gray-700">Date:</label>
                    <input type="text" id="date" name="date" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="e.g., 6th August, 2025">
                </div>
                <h3 class="text-xl font-bold mt-8">Applicant and Family Details</h3>
                <div>
                    <label for="applicantName" class="block text-sm font-medium text-gray-700">Applicant's Name (e.g., Arishma Khatri):</label>
                    <input type="text" id="applicantName" name="applicantName" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="Applicant's name">
                </div>
                <div>
                    <label for="fatherName" class="block text-sm font-medium text-gray-700">Father's Name (e.g., Mr. Yam Bahadur Khatri):</label>
                    <input type="text" id="fatherName" name="fatherName" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="Father's name">
                </div>
                <div>
                    <label for="motherName" class="block text-sm font-medium text-gray-700">Mother's Name (e.g., Mrs. Khima Khatri):</label>
                    <input type="text" id="motherName" name="motherName" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="Mother's name">
                </div>
                <div>
                    <label for="residenceAddress" class="block text-sm font-medium text-gray-700">Permanent Address (Municipality, Ward No., District, Province, Nepal):</label>
                    <input type="text" id="residenceAddress" name="residenceAddress" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="e.g., Galkot Municipality, Ward No. 8, Baglung District, Gandaki Province, Nepal">
                </div>
                <div>
                    <label for="fiscalYearEnglish" class="block text-sm font-medium text-gray-700">Fiscal Year for Income (e.g., 2024/2025 A.D.):</label>
                    <input type="text" id="fiscalYearEnglish" name="fiscalYearEnglish" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="e.g., 2024/2025 A.D.">
                </div>
                <h3 class="text-xl font-bold mt-8">Details of Income Sources</h3>
                <div id="incomeSourcesContainer" class="space-y-4">
                    </div>
                <button type="button" id="addSourceBtn" class="px-4 py-2 border rounded-md text-white bg-blue-600 hover:bg-blue-700">Add New Source</button>
                <div>
                    <label for="exchangeRate" class="block text-sm font-medium text-gray-700">Exchange Rate (1 AUD = NRs.):</label>
                    <input type="number" id="exchangeRate" name="exchangeRate" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="e.g., 90.94">
                </div>
                <div>
                    <label for="wardChairpersonName" class="block text-sm font-medium text-gray-700">Ward Chairperson's Name:</label>
                    <input type="text" id="wardChairpersonName" name="wardChairpersonName" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="e.g., Tej Prasad Sapkota">
                </div>
                <div class="buttons-container mt-8 flex justify-center space-x-4">
                    <button type="button" id="previewBtn" class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Preview
                    </button>
                    <button type="button" id="backToFormBtn" class="px-6 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" style="display: none;">
                        Back to Form
                    </button>
                    <button type="button" id="printBtn" class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" style="display: none;">
                        Print
                    </button>
                </div>
            </form>
        </div>
        <div id="previewSection" class="preview-section">
            <div class="watermark-container">
                <img src="https://galkotmun.gov.np/sites/galkotmun.gov.np/files/logo_0.png" alt="Watermark" class="watermark" />
                <div class="letter-content text-sm leading-6">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex-1 text-left">
                            <img src="https://galkotmun.gov.np/sites/galkotmun.gov.np/files/logo_0.png" alt="Logo" class="w-16 h-auto mb-2" />
                        </div>
                        <div class="flex-1 text-center">
                            <p class="font-bold text-lg red-text" id="previewMunicipality"></p>
                            <p class="font-bold text-lg red-text" id="previewWardOffice"></p>
                            <p class="red-text" id="previewOfficeAddress"></p>
                            <p class="red-text">Gandaki Province, Nepal</p>
                        </div>
                        <div class="flex-1 text-right">
                            <p>Website: <span class="dotted-line-bottom">galkotmun.gov.np</span></p>
                            <p>Email: <span class="dotted-line-bottom">galkot8k@gmail.com</span></p>
                            <p>Phone No.: <span class="dotted-line-bottom">+९७७-९८५७६२१११४</span></p>
                        </div>
                    </div>
                    <div class="flex justify-between mt-4">
                        <p class="header-left-align">
                            Fiscal Year: <span class="no-wrap bold-text" id="previewFiscalYear"></span><br>
                            Ref. No.: <span class="no-wrap bold-text" id="previewRefNo"></span>
                        </p>
                        <p class="header-right-align">
                            Date: <span class="no-wrap bold-text" id="previewDate"></span>
                        </p>
                    </div>
                    <hr class="black-line">
                    <div class="text-center mt-4">
                        <p class="font-bold text-xl">
                            Subject: Source of Income Verification
                        </p>
                        <p class="font-bold text-lg">
                            To Whom It May Concern
                        </p>
                    </div>
                    <div class="mt-8 text-justify">
                        <p>
                            This is to certify that Mr. <span class="bold-text" id="previewFatherName"></span> (Father) and Mrs. <span class="bold-text" id="previewMotherName"></span> (Mother) of Miss/Mr. <span class="bold-text" id="previewApplicantName"></span> (Applicant), a permanent resident of <span class="bold-text" id="previewResidenceAddress"></span>, have the following annual income from various sources.
                        </p>
                    </div>
                    <div class="mt-4 text-justify">
                        <p>
                            This income certification is made with the verification of concerned documents and record of this Municipality and this income is calculated for the fiscal year <span class="bold-text" id="previewFiscalYearEnglish"></span>.
                        </p>
                    </div>
                    <div class="text-center mt-8">
                        <p class="font-bold text-lg">
                            Details of Income Source
                        </p>
                    </div>
                    <div class="mt-2">
                        <table class="dotted-table">
                            <thead>
                                <tr>
                                    <th>S.N.</th>
                                    <th>Sources of Income</th>
                                    <th>Earned By</th>
                                    <th>Annual Income (NPR)</th>
                                    <th>Remarks</th>
                                </tr>
                            </thead>
                            <tbody id="incomeTableBody">
                                </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="3" class="text-right font-bold">Grand Total In NPR:</td>
                                    <td class="font-bold" id="previewTotalIncome"></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td colspan="3" class="text-right font-bold">Equivalent to AUD:</td>
                                    <td class="font-bold" id="previewEquivalentToAUD"></td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div class="mt-4 text-justify">
                        <p>
                            Total Annual Income: <span class="bold-text" id="previewTotalAnnualIncome"></span>
                        </p>
                    </div>
                    <div class="mt-4 text-justify">
                        <p>
                            Amount in word: <span class="bold-text" id="previewTotalIncomeWords"></span>
                        </p>
                    </div>
                    <div class="mt-4 text-justify">
                        <p>
                            This is equivalent to AUD: <span class="bold-text" id="previewEquivalentToAUDText"></span>
                        </p>
                    </div>
                    <div class="mt-4 text-justify">
                        <p id="previewExchangeRateNote"></p>
                    </div>
                    <div class="mt-10 signature-container">
                        <div class="signature-line-box">
                            <span class="signature-line"></span>
                            <br>
                            <span class="font-bold">Ward Chairperson</span>
                        </div>
                        <p id="previewWardChairpersonName"></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="buttons-container mt-8 flex justify-center space-x-4">
            <button type="button" id="previewBtn" class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                Preview
            </button>
            <button type="button" id="backToFormBtn" class="px-6 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" style="display: none;">
                Back to Form
            </button>
            <button type="button" id="printBtn" class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" style="display: none;">
                Print
            </button>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const formSection = document.getElementById('formSection');
            const previewSection = document.getElementById('previewSection');
            const previewBtn = document.getElementById('previewBtn');
            const backToFormBtn = document.getElementById('backToFormBtn');
            const printBtn = document.getElementById('printBtn');
            const addSourceBtn = document.getElementById('addSourceBtn');
            const incomeSourcesContainer = document.getElementById('incomeSourcesContainer');
            const exchangeRateInput = document.getElementById('exchangeRate');

            // Function to convert number to English words
            const a = ['','one ','two ','three ','four ', 'five ','six ','seven ','eight ','nine ','ten ','eleven ','twelve ','thirteen ','fourteen ','fifteen ','sixteen ','seventeen ','eighteen ','nineteen '];
            const b = ['', '', 'twenty','thirty','forty','fifty', 'sixty','seventy','eighty','ninety'];
            
            function inWords(num) {
                if ((num = num.toString()).length > 9) return 'overflow';
                const n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
                if (!n) return '';
                let str = '';
                str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + 'crore ' : '';
                str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + 'lakh ' : '';
                str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + 'thousand ' : '';
                str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + 'hundred ' : '';
                if (n[5] != 0) {
                    str += ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]);
                }
                const capitalizedStr = str.trim().charAt(0).toUpperCase() + str.trim().slice(1);
                return capitalizedStr + ' only.';
            }

            // Function to add a new income source row
            function addIncomeSourceRow() {
                const newRow = document.createElement('div');
                newRow.classList.add('income-source-row', 'p-4', 'border', 'rounded-md', 'bg-gray-50', 'flex', 'items-end', 'space-x-2');
                newRow.innerHTML = `
                    <div class="flex-grow">
                        <label class="block text-sm font-medium text-gray-700">Source of Income</label>
                        <input type="text" class="mt-1 block w-full px-3 py-2 border rounded-md source-input" placeholder="e.g., Income from Pension">
                    </div>
                    <div class="flex-grow">
                        <label class="block text-sm font-medium text-gray-700">Earned By</label>
                        <input type="text" class="mt-1 block w-full px-3 py-2 border rounded-md earned-by-input" placeholder="e.g., Mr. Yam Bahadur Khatri">
                    </div>
                    <div class="flex-grow">
                        <label class="block text-sm font-medium text-gray-700">Annual Income (NPR)</label>
                        <input type="number" class="mt-1 block w-full px-3 py-2 border rounded-md amount-input" placeholder="In Nepali Rupees">
                    </div>
                     <div class="flex-grow">
                        <label class="block text-sm font-medium text-gray-700">Remarks</label>
                        <input type="text" class="mt-1 block w-full px-3 py-2 border rounded-md remarks-input" placeholder="e.g., As per document">
                    </div>
                    <button type="button" class="remove-row-btn px-4 py-2 border rounded-md text-white bg-red-500 hover:bg-red-600">Remove</button>
                `;
                incomeSourcesContainer.appendChild(newRow);
                newRow.querySelector('.remove-row-btn').addEventListener('click', function() {
                    newRow.remove();
                });
            }
            
            // Event listeners
            addSourceBtn.addEventListener('click', addIncomeSourceRow);
            
            // Add initial rows on page load
            addIncomeSourceRow();
            addIncomeSourceRow();
            addIncomeSourceRow();

            // Optional: Auto-populate with sample data from the image for demonstration
            document.querySelectorAll('.source-input')[0].value = 'Income from Pension (Ex-Indian Army)';
            document.querySelectorAll('.earned-by-input')[0].value = 'Mr. Yam Bahadur Khatri';
            document.querySelectorAll('.amount-input')[0].value = '436248';
            document.querySelectorAll('.remarks-input')[0].value = 'As per pension document';
            
            document.querySelectorAll('.source-input')[1].value = 'Income from Employment (Employer RESTAURANTEE PIZZARIA CASA ALFARMA, LDA)';
            document.querySelectorAll('.earned-by-input')[1].value = 'Mr. Yam Bahadur Khatri';
            document.querySelectorAll('.amount-input')[1].value = '1801277.93';
            document.querySelectorAll('.remarks-input')[1].value = 'As per salary certificate and salary slip';

            document.querySelectorAll('.source-input')[2].value = 'Income from Land Lease Plot No. 1319';
            document.querySelectorAll('.earned-by-input')[2].value = 'Mrs. Khima Khatri';
            document.querySelectorAll('.amount-input')[2].value = '240000';
            document.querySelectorAll('.remarks-input')[2].value = 'As per Land Lease Agreement';

            document.getElementById('fiscalYear').value = '2082/083';
            document.getElementById('refNo').value = '45';
            document.getElementById('date').value = '6th August, 2025';
            document.getElementById('applicantName').value = 'Arishma Khatri';
            document.getElementById('fatherName').value = 'Mr. Yam Bahadur Khatri';
            document.getElementById('motherName').value = 'Mrs. Khima Khatri';
            document.getElementById('residenceAddress').value = 'Galkot Municipality, Ward No. 8, Baglung District, Gandaki Province, Nepal';
            document.getElementById('fiscalYearEnglish').value = '2024/2025 A.D.';
            document.getElementById('exchangeRate').value = '90.94';
            document.getElementById('wardChairpersonName').value = 'Tej Prasad Sapkota';
            document.getElementById('municipalityName').value = 'Galkot Municipality';
            document.getElementById('wardOfficeName').value = '8 No. Ward Office';
            document.getElementById('officeAddress').value = 'Kandebas, Baglung';


            previewBtn.addEventListener('click', function() {
                let total = 0;
                const incomeData = [];
                document.querySelectorAll('.income-source-row').forEach(row => {
                    const source = row.querySelector('.source-input').value;
                    const earnedBy = row.querySelector('.earned-by-input').value;
                    const amount = parseFloat(row.querySelector('.amount-input').value) || 0;
                    const remarks = row.querySelector('.remarks-input').value;
                    if (source && amount > 0) {
                        incomeData.push({ source, earnedBy, amount, remarks });
                        total += amount;
                    }
                });

                const exchangeRate = parseFloat(exchangeRateInput.value) || 0;
                let equivalentAUD = 0;
                if (total > 0 && exchangeRate > 0) {
                    equivalentAUD = total / exchangeRate;
                }
                
                // Get all form data
                const formData = {
                    municipalityName: document.getElementById('municipalityName').value || 'Galkot Municipality',
                    wardOfficeName: document.getElementById('wardOfficeName').value || '8 No. Ward Office',
                    officeAddress: document.getElementById('officeAddress').value || 'Kandebas, Baglung',
                    fiscalYear: document.getElementById('fiscalYear').value,
                    refNo: document.getElementById('refNo').value,
                    date: document.getElementById('date').value,
                    applicantName: document.getElementById('applicantName').value,
                    fatherName: document.getElementById('fatherName').value,
                    motherName: document.getElementById('motherName').value,
                    residenceAddress: document.getElementById('residenceAddress').value,
                    fiscalYearEnglish: document.getElementById('fiscalYearEnglish').value,
                    totalIncome: total.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }),
                    totalIncomeWords: inWords(Math.round(total)),
                    equivalentToAUD: equivalentAUD.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }),
                    exchangeRate: document.getElementById('exchangeRate').value,
                    wardChairpersonName: document.getElementById('wardChairpersonName').value,
                };
                
                // Update preview content
                document.getElementById('previewMunicipality').textContent = formData.municipalityName;
                document.getElementById('previewWardOffice').textContent = formData.wardOfficeName;
                document.getElementById('previewOfficeAddress').textContent = formData.officeAddress;
                document.getElementById('previewFiscalYear').textContent = formData.fiscalYear;
                document.getElementById('previewRefNo').textContent = formData.refNo;
                document.getElementById('previewDate').textContent = formData.date;
                document.getElementById('previewApplicantName').textContent = formData.applicantName;
                document.getElementById('previewFatherName').textContent = formData.fatherName;
                document.getElementById('previewMotherName').textContent = formData.motherName;
                document.getElementById('previewResidenceAddress').textContent = formData.residenceAddress;
                document.getElementById('previewFiscalYearEnglish').textContent = formData.fiscalYearEnglish;
                document.getElementById('previewTotalIncome').textContent = formData.totalIncome;
                document.getElementById('previewTotalAnnualIncome').textContent = formData.totalIncome;
                document.getElementById('previewTotalIncomeWords').textContent = formData.totalIncomeWords;
                document.getElementById('previewEquivalentToAUD').textContent = formData.equivalentToAUD;
                document.getElementById('previewEquivalentToAUDText').textContent = parseFloat(formData.equivalentToAUD.replace(/,/g, '')).toFixed(2);
                
                if (formData.exchangeRate && formData.date) {
                    document.getElementById('previewExchangeRateNote').innerHTML = `**Please Note that the exchange rate as of ${formData.date} is 1 AUD = NRs. ${formData.exchangeRate}**`;
                } else {
                    document.getElementById('previewExchangeRateNote').innerHTML = '';
                }
                document.getElementById('previewWardChairpersonName').textContent = formData.wardChairpersonName;
                
                // Populate the income table
                const incomeTableBody = document.getElementById('incomeTableBody');
                incomeTableBody.innerHTML = '';
                incomeData.forEach((item, index) => {
                    const row = `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${item.source}</td>
                            <td>${item.earnedBy}</td>
                            <td>${item.amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                            <td>${item.remarks}</td>
                        </tr>
                    `;
                    incomeTableBody.innerHTML += row;
                });

                // Show preview and hide form
                formSection.classList.remove('active');
                previewSection.classList.add('active');
                previewBtn.style.display = 'none';
                backToFormBtn.style.display = 'inline-block';
                printBtn.style.display = 'inline-block';
            });
            backToFormBtn.addEventListener('click', function() {
                // Show form and hide preview
                formSection.classList.add('active');
                previewSection.classList.remove('active');
                previewBtn.style.display = 'inline-block';
                backToFormBtn.style.display = 'none';
                printBtn.style.display = 'none';
            });
            printBtn.addEventListener('click', function() {
                window.print();
            });
        });
    </script>
</body>
</html>
