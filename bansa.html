<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>वंशावली - Family Tree</title>
<style>
    body { font-family: Arial; padding: 20px; overflow-x: auto; }
    #searchBox { width: 300px; height: 30px; margin-bottom: 20px; padding:5px; font-size:16px; }
    .tree { white-space: nowrap; display:flex; align-items:center; }
    .node { text-align:center; padding:10px; background:white; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.2); display:inline-block; margin:20px; }
    .node img { width:80px;height:80px;border-radius:50%;border:3px solid #4a90e2; object-fit:cover; }
    .line { height:2px; background:#4a90e2; flex:1; }
    .children { display:flex; justify-content:center; margin-top:20px; }
</style>
</head>
<body>

<h2>वंशावली Viewer</h2>
<input type="text" id="searchBox" placeholder="नाम खोज्नुहोस्...">
<div id="treeContainer"></div>

<script>
// Google Sheet data fetch via Apps Script
let persons = {};

google.script.run.withSuccessHandler(dataLoaded).loadFamilyData();

function dataLoaded(data) {
    persons = data;
    const root = Object.values(persons).find(p => !p.father_id);
    renderTree(root);
}

function renderNode(p) {
    return `<div class="node"><img src="${p.photo}"><h4>${p.name}</h4><small>DOB: ${p.dob}</small></div>`;
}

function renderTree(person) {
    if (!person) return;

    let html = `<div class="tree">${renderNode(person)}</div>`;

    if (person.children.length > 0) {
        html += `<div class="children">`;
        person.children.forEach(child => {
            html += `<div><div class="line"></div>${renderNode(child)}${child.children.length>0 ? renderTree(child) : ""}</div>`;
        });
        html += `</div>`;
    }

    document.getElementById("treeContainer").innerHTML = html;
}

// Search by name
document.getElementById("searchBox").addEventListener("input", e => {
    const q = e.target.value.toLowerCase();
    const found = Object.values(persons).find(p => p.name.toLowerCase() === q);
    if (found) renderTree(found);
});
</script>

</body>
</html>
